!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(t._Highcharts,t._Highcharts.SeriesRegistry,t._Highcharts.Point,t._Highcharts.Color,t._Highcharts.SVGElement):"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts/highcharts"],function(t){return e(t,t.SeriesRegistry,t.Point,t.Color,t.SVGElement)}):"object"==typeof exports?exports["highcharts/modules/sankey"]=e(t._Highcharts,t._Highcharts.SeriesRegistry,t._Highcharts.Point,t._Highcharts.Color,t._Highcharts.SVGElement):t.Highcharts=e(t.Highcharts,t.Highcharts.SeriesRegistry,t.Highcharts.Point,t.Highcharts.Color,t.Highcharts.SVGElement)}("undefined"==typeof window?this:window,(ht,dt,ct,pt,ut)=>(()=>{"use strict";var z={28:t=>{t.exports=ut},260:t=>{t.exports=ct},512:t=>{t.exports=dt},620:t=>{t.exports=pt},944:t=>{t.exports=ht}},o={};function i(t){var e=o[t];if(void 0!==e)return e.exports;e=o[t]={exports:{}};return z[t](e,e.exports,i),e.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var t={},e=(i.d(t,{default:()=>lt}),i(944)),e=i.n(e),s=i(512),s=i.n(s);const{prototype:n,prototype:{pointClass:{prototype:l}}}=s()["series"],{defined:r,extend:D,find:B,merge:E,pick:h}=e();function a(){return this.data=[].concat(this.points||[],this.nodes),n.destroy.apply(this,arguments)}function Y(){this.nodes&&(this.nodes.forEach(t=>{t.destroy()}),this.nodes.length=0),n.setData.apply(this,arguments)}function d(t){const e=arguments,o=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==t&&o.forEach(t=>{t&&t.series&&(l.setState.apply(t,e),t.isNode||(t.fromNode.graphic&&l.setState.apply(t.fromNode,e),t.toNode&&t.toNode.graphic&&l.setState.apply(t.toNode,e)))}),l.setState.apply(this,e)}function c(t,e,o,i){const s=this.series.options.nodes,n=this.series.options.data,r=n?.length||0,a=n?.[this.index];l.update.call(this,t,!this.isNode&&e,o,i),this.isNode&&(t=(s||[]).reduce((t,e,o)=>this.id===e.id?o:t,-1),i=E(s&&s[t]||{},n?.[this.index]||{}),n&&(a?n[this.index]=a:n.length=r),s?0<=t?s[t]=i:s.push(i):this.series.options.nodes=[i],h(e,!0)&&this.series.chart.redraw(o))}(u=m=m||{}).compose=function(t,e){const o=t.prototype,i=e.prototype;return o.setNodeState=d,o.setState=d,o.update=c,i.destroy=a,i.setData=Y,e},u.createNode=function(t){const e=this.pointClass,o=(t,e)=>B(t,t=>t.id===e);let i=o(this.nodes,t),s;if(!i){s=this.options.nodes&&o(this.options.nodes,t);const n=new e(this,D({className:"highcharts-node",isNode:!0,id:t,y:1},s));n.linksTo=[],n.linksFrom=[],n.getSum=function(){let e=0,o=0;return n.linksTo.forEach(t=>{e+=t.weight||0}),n.linksFrom.forEach(t=>{o+=t.weight||0}),Math.max(e,o)},n.offset=function(e,o){let i=0;for(let t=0;t<n[o].length;t++){if(n[o][t]===e)return i;i+=n[o][t].weight}},n.hasShape=function(){let e=0;return n.linksTo.forEach(t=>{t.outgoing&&e++}),!n.linksTo.length||e!==n.linksTo.length},n.index=this.nodes.push(n)-1,i=n}return i.formatPrefix="node",i.name=i.name||i.options.id||"",i.mass=h(i.options.mass,i.options.marker&&i.options.marker.radius,this.options.marker&&this.options.marker.radius,4),i},u.destroy=a,u.generatePoints=function(){const e=this.chart,o={};n.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(t=>{t.linksFrom.length=0,t.linksTo.length=0,t.level=t.options.level}),this.points.forEach(t=>{r(t.from)&&(o[t.from]||(o[t.from]=this.createNode(t.from)),o[t.from].linksFrom.push(t),t.fromNode=o[t.from],e.styledMode?t.colorIndex=h(t.options.colorIndex,o[t.from].colorIndex):t.color=t.options.color||o[t.from].color),r(t.to)&&(o[t.to]||(o[t.to]=this.createNode(t.to)),o[t.to].linksTo.push(t),t.toNode=o[t.to]),t.name=t.name||t.id},this),this.nodeLookup=o},u.setNodeState=d,u.updateNode=c;const p=m;var u=i(260),f=i.n(u),m=s().seriesTypes["column"];const g=e()["defined"];class R extends m.prototype.pointClass{applyOptions(t,e){return f().prototype.applyOptions.call(this,t,e),g(this.options.level)&&(this.options.column=this.column=this.options.level),this}getClassName(){return(this.isNode?"highcharts-node ":"highcharts-link ")+f().prototype.getClassName.call(this)}getFromNode(){let e=-1,o;for(let t=0;t<this.linksTo.length;t++){var i=this.linksTo[t];i.fromNode.column>e&&i.fromNode!==this&&(o=i.fromNode,e=o.column)}return{fromNode:o,fromColumn:e}}setNodeColumn(){var t=this;g(t.options.column)||(0===t.linksTo.length?t.column=0:t.column=t.getFromNode().fromColumn+1)}isValid(){return this.isNode||"number"==typeof this.weight}}u=R,m={borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkColorMode:"from",linkOpacity:.5,opacity:1,minLinkWidth:0,nodeAlignment:"center",nodeWidth:20,nodePadding:10,nodeDistance:30,showInLegend:!1,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}};const{defined:_,getAlignFactor:X,relativeLength:y}=e();{var v;(v=S=S||{}).compose=function(t,e){const o=t;return o.sankeyColumn=new H(o,e),o};class H{constructor(t,e){this.points=t,this.series=e}getTranslationFactor(t){const e=this.points,o=e.slice(),i=t.chart,s=t.options.minLinkWidth||0;let n,r=0,a,l=(i.plotSizeY||0)-(t.options.borderWidth||0)-(e.length-1)*t.nodePadding;for(;e.length;){for(r=l/e.sankeyColumn.sum(),n=!1,a=e.length;a--;)e[a].getSum()*r<s&&(e.splice(a,1),l=Math.max(0,l-s),n=!0);if(!n)break}e.length=0;for(const h of o)e.push(h);return r}top(o){const i=this.series,s=i.nodePadding,t=this.points.reduce((t,e)=>{return 0<t&&(t+=s),t+=Math.max(e.getSum()*o,i.options.minLinkWidth||0)},0);return X(i.options.nodeAlignment||"center")*((i.chart.plotSizeY||0)-t)}left(o){const i=this.series,t=i.chart,s=i.options.equalNodes,n=t.inverted?t.plotHeight:t.plotWidth,r=i.nodePadding,e=this.points.reduce((t,e)=>{return 0<t&&(t+=r),t+=s?n/e.series.nodes.length-r:Math.max(e.getSum()*o,i.options.minLinkWidth||0)},0);return((t.plotSizeX||0)-Math.round(e))/2}sum(){return this.points.reduce((t,e)=>t+e.getSum(),0)}offset(e,o){const i=this.points,s=this.series,n=s.nodePadding;let r=0,a;if(s.is("organization")&&e.hangsFrom)return{absoluteTop:e.hangsFrom.nodeY};for(let t=0;t<i.length;t++){var l=i[t].getSum(),h=Math.max(l*o,s.options.minLinkWidth||0),d=e.options[s.chart.inverted?"offsetHorizontal":"offsetVertical"],c=e.options.offset||0;if(a=l?h+n:0,i[t]===e)return{relativeTop:r+(_(d)?y(d,h):y(c,a))};r+=a}}}v.SankeyColumnAdditions=H}const b=S;var v=i(620),x=i.n(v);const{extend:k,isArray:V,isNumber:C,isObject:N,merge:P,pick:L,relativeLength:j}=e();var S={getColor:function(t,e){const o=e.index,i=e.mapOptionsToLevel,s=e.parentColor,n=e.parentColorIndex,r=e.series,a=e.colors,l=e.siblings,h=r.points,d=r.chart.options.chart;let c,p,u,f,m,g;var y;return t&&(c=h[t.i],p=i[t.level]||{},c&&p.colorByPoint&&(f=c.index%(a?a.length:d.colorCount),u=a&&a[f]),r.chart.styledMode||(m=L(c&&c.options.color,p&&p.color,u,s&&(t=s,(y=p&&p.colorVariation)&&"brightness"===y.key&&o&&l?x().parse(t).brighten(y.to*(o/l)).get():t),r.color)),g=L(c&&c.options.colorIndex,p&&p.colorIndex,f,n,e.colorIndex)),{color:m,colorIndex:g}},getLevelOptions:function(t){const e={};let n,o,i,r,s,a;if(N(t))for(r=C(t.from)?t.from:1,a=t.levels,o={},n=N(t.defaults)?t.defaults:{},V(a)&&(o=a.reduce((t,e)=>{let o,i,s;return N(e)&&C(e.level)&&(s=P({},e),i=L(s.levelIsConstant,n.levelIsConstant),delete s.levelIsConstant,delete s.level,o=e.level+(i?0:r-1),N(t[o])?P(!0,t[o],s):t[o]=s),t},{})),s=C(t.to)?t.to:1,i=0;i<=s;i++)e[i]=P({},n,N(o[i])?o[i]:{});return e},getNodeWidth:function(t,e){var{chart:t,options:o}=t,{nodeDistance:o=0,nodeWidth:i=0}=o,{plotSizeX:t=1}=t;return"auto"!==i?j(i,t):"string"==typeof o&&/%$/.test(o)?t/(e+parseFloat(o)/100*(e-1)):(i=Number(o),(t+i)/(e||1)-i)},setTreeValues:function i(s,n){const t=n.before,e=n.idRoot,o=n.mapIdToNode,r=o[e],a=!1!==n.levelIsConstant,l=n.points,h=l[s.i],d=h&&h.options||{},c=[];let p=0;s.levelDynamic=s.level-(a?0:r.level),s.name=L(h&&h.name,""),s.visible=e===s.id||!0===n.visible,(s="function"==typeof t?t(s,n):s).children.forEach((t,e)=>{var o=k({},n);k(o,{index:e,siblings:s.children.length,visible:s.visible}),t=i(t,o),c.push(t),t.visible&&(p+=t.val)});var u=L(d.value,p);return s.visible=0<=u&&(0<p||s.visible),s.children=c,s.childrenTotal=p,s.isLeaf=s.visible&&!p,s.val=u,s},updateRootId:function(t){let e,o;return N(t)&&(o=N(t.options)?t.options:{},e=L(t.rootNode,o.rootId,""),N(t.userOptions)&&(t.userOptions.rootId=e),t.rootNode=e),e}},v=i(28),v=i.n(v);const G=e()["deg2rad"],{addEvent:T,merge:q,uniqueKey:Z,defined:w,extend:K}=e();function $(s,t){t=q(!0,{enabled:!0,attributes:{dy:-5,startOffset:"50%",textAnchor:"middle"}},t);const n=this.renderer.url,r=this.text||this,e=r.textPath,{attributes:a,enabled:l}=t;return s=s||e&&e.path,e&&e.undo(),s&&l?(t=T(r,"afterModifyTree",e=>{if(s&&l){let t=s.attr("id");t||s.attr("id",t=Z());const i={x:0,y:0};w(a.dx)&&(i.dx=a.dx,delete a.dx),w(a.dy)&&(i.dy=a.dy,delete a.dy),r.attr(i),this.attr({transform:""}),this.box&&(this.box=this.box.destroy());var o=e.nodes.slice(0);e.nodes.length=0,e.nodes[0]={tagName:"textPath",attributes:K(a,{"text-anchor":a.textAnchor,href:n+"#"+t}),children:o}}}),r.textPath={path:s,undo:t}):(r.attr({dx:0,dy:0}),delete r.textPath),this.added&&(r.textCache="",this.renderer.buildText(r)),this}function J(t){const e=t.bBox,s=this.element?.querySelector("textPath");if(s){const p=[],{b:u,h:o}=this.renderer.fontMetrics(this.element),f=o-u,m=new RegExp('(<tspan>|<tspan(?!\\sclass="highcharts-br")[^>]*>|<\\/tspan>)',"g"),g=s.innerHTML.replace(m,"").split(/<tspan class="highcharts-br"[^>]*>/),y=g.length;var i=(t,e)=>{var{x:e,y:o}=e,t=(s.getRotationOfChar(t)-90)*G,i=Math.cos(t),t=Math.sin(t);return[[e-f*i,o-f*t],[e+u*i,o+u*t]]};for(let e=0,o=0;o<y;o++){var n=g[o].length;for(let t=0;t<n;t+=5)try{var r=e+t+o,[a,l]=i(r,s.getStartPositionOfChar(r));0===t?(p.push(l),p.push(a)):(0===o&&p.unshift(l),o===y-1&&p.push(a))}catch(t){break}e+=n-1;try{var h=e+o,[d,c]=i(h,s.getEndPositionOfChar(h));p.unshift(c),p.unshift(d)}catch(t){break}}p.length&&p.push(p[0].slice()),e.polygon=p}return e}function Q(t){const e=t.labelOptions,o=t.point,i=e[o.formatPrefix+"TextPath"]||e.textPath;i&&!e.useHTML&&(this.setTextPath(o.getDataLabelPath?.(this)||o.graphic,i),o.dataLabelPath&&!i.enabled&&(o.dataLabelPath=o.dataLabelPath.destroy()))}const U={compose:function(t){T(t,"afterGetBBox",J),T(t,"beforeAddingDataLabel",Q);const e=t.prototype;e.setTextPath||(e.setTextPath=$)}},{column:O,line:tt}=s().seriesTypes,I=x()["parse"],{getLevelOptions:et,getNodeWidth:ot}=S,{clamp:it,crisp:M,extend:st,isObject:F,merge:nt,pick:A,relativeLength:rt,stableSort:at}=e();U.compose(v());class W extends O{static getDLOptions(t){var e=F(t.optionsPoint)?t.optionsPoint.dataLabels:{},t=F(t.level)?t.level.dataLabels:{};return nt({style:{}},t,e)}createNodeColumns(){const e=[];for(const t of this.nodes)t.setNodeColumn(),e[t.column]||(e[t.column]=b.compose([],this)),e[t.column].push(t);for(let t=0;t<e.length;t++)void 0===e[t]&&(e[t]=b.compose([],this));return e}order(t,e){if(void 0===t.level){t.level=e;for(const o of t.linksFrom)o.toNode&&this.order(o.toNode,e+1)}}generatePoints(){if(p.generatePoints.apply(this,arguments),this.orderNodes){for(const t of this.nodes)0===t.linksTo.length&&this.order(t,0);at(this.nodes,(t,e)=>t.level-e.level)}}getNodePadding(){let t=this.options.nodePadding||0;var e;return t=this.nodeColumns&&(e=this.nodeColumns.reduce((t,e)=>Math.max(t,e.length),0))*t>this.chart.plotSizeY?this.chart.plotSizeY/e:t}hasData(){return!!this.dataTable.rowCount}pointAttribs(t,e){if(!t)return{};const o=this,i=(t.isNode?t:t.fromNode).level,s=o.mapOptionsToLevel[i||0]||{},n=t.options,r=s.states&&s.states[e||""]||{},a=["colorByPoint","borderColor","borderWidth","linkOpacity","opacity"].reduce((t,e)=>(t[e]=A(r[e],n[e],s[e],o.options[e]),t),{}),l=A(r.color,n.color,(a.colorByPoint?t:s).color);return t.isNode?{fill:l,stroke:a.borderColor,"stroke-width":a.borderWidth,opacity:a.opacity}:{fill:l,"fill-opacity":a.linkOpacity}}drawTracker(){O.prototype.drawTracker.call(this,this.points),O.prototype.drawTracker.call(this,this.nodes)}drawPoints(){O.prototype.drawPoints.call(this,this.points),O.prototype.drawPoints.call(this,this.nodes)}drawDataLabels(){O.prototype.drawDataLabels.call(this,this.points),O.prototype.drawDataLabels.call(this,this.nodes)}translate(){this.generatePoints(),this.nodeColumns=this.createNodeColumns();const o=this,t=this.chart,e=this.options,i=this.nodeColumns,s=i.length;this.nodeWidth=ot(this,s),this.nodePadding=this.getNodePadding(),this.translationFactor=i.reduce((t,e)=>Math.min(t,e.sankeyColumn.getTranslationFactor(o)),1/0),this.colDistance=(t.plotSizeX-this.nodeWidth-e.borderWidth)/Math.max(1,i.length-1),o.mapOptionsToLevel=et({from:1,levels:e.levels,to:i.length-1,defaults:{borderColor:e.borderColor,borderRadius:e.borderRadius,borderWidth:e.borderWidth,color:o.color,colorByPoint:e.colorByPoint,levelIsConstant:!0,linkColor:e.linkColor,linkLineWidth:e.linkLineWidth,linkOpacity:e.linkOpacity,states:e.states}});for(const n of i)for(const r of n)o.translateNode(r,n);for(const a of this.nodes)for(const l of a.linksFrom)(l.weight||l.isNull)&&l.to&&(o.translateLink(l),l.allowShadow=!1)}translateLink(o){var t,e,i,s,n,r,a,l,h,d,c,p,u,f,m,g,y,v,b=(t,e)=>{e=t.offset(o,e)*P;return Math.min(t.nodeY+e,t.nodeY+(t.shapeArgs&&t.shapeArgs.height||0)-F)};const x=o.fromNode,k=o.toNode,C=this.chart,N=C["inverted"],P=this.translationFactor,L=this.options,S=A(o.linkColorMode,L.linkColorMode),T=(C.inverted?-this.colDistance:this.colDistance)*L.curveFactor,w=x.nodeX,O=k.nodeX,M=o.outgoing;let F=Math.max(o.weight*P,this.options.minLinkWidth),W=b(x,"linksFrom"),H=b(k,"linksTo"),z=this.nodeWidth,D=O>w+z;C.inverted&&(W=C.plotSizeY-W,H=(C.plotSizeY||0)-H,z=-z,F=-F,D=O<w),o.shapeType="path",o.linkBase=[W,W+F,H,H+F],D&&"number"==typeof H?o.shapeArgs={d:[["M",w+z,W],["C",w+z+T,W,O-T,H,O,H],["L",O+(M?z:0),H+F/2],["L",O,H+F],["C",O-T,H+F,w+z+T,W+F,w+z,W+F],["Z"]]}:"number"==typeof H&&(b=C.plotHeight-W-F,t=O-20-F,e=O-20,n=(s=(i=w+z)+20)+F,h=(l=(b=(a=(r=(y=W)+F)+20)+b)+20)+F,p=(c=(d=H)+F)+20,v=r-.7*F,u=l+.7*F,f=c-.7*F,m=O-.7*F,g=i+.7*F,o.shapeArgs={d:[["M",i,y],["C",g,y,n,v,n,a],["L",n,b],["C",n,u,g,h,i,h],["L",O,h],["C",m,h,t,u,t,b],["L",t,p],["C",t,f,m,d,O,d],["L",O,c],["C",e,c,e,c,e,p],["L",e,b],["C",e,l,e,l,O,l],["L",i,l],["C",s,l,s,l,s,b],["L",s,a],["C",s,r,s,r,i,r],["Z"]]}),o.dlBox={x:w+(O-w+z)/2,y:W+(H-W)/2,height:F,width:0},o.tooltipPos=C.inverted?[C.plotSizeY-o.dlBox.y-F/2,C.plotSizeX-o.dlBox.x]:[o.dlBox.x,o.dlBox.y+F/2],o.y=o.plotY=1,o.x=o.plotX=1,o.options.color||("from"===S?o.color=x.color:"to"===S?o.color=k.color:"gradient"===S&&(y=I(x.color).get(),v=I(k.color).get(),o.color={linearGradient:{x1:1,x2:0,y1:0,y2:0},stops:[[0,N?y:v],[1,N?v:y]]}))}translateNode(s,n){var t=this.translationFactor,r=this.chart,a=this.options,{borderRadius:l,borderWidth:h=0}=a,e=s.getSum(),d=Math.max(Math.round(e*t),this.options.minLinkWidth),c=Math.round(this.nodeWidth),p=n.sankeyColumn.offset(s,t),n=M(A(p.absoluteTop,n.sankeyColumn.top(t)+p.relativeTop),h),t=M(this.colDistance*s.column+h/2,h)+rt(s.options[r.inverted?"offsetVertical":"offsetHorizontal"]||0,c),p=r.inverted?r.plotSizeX-t:t;if(s.sum=e){s.shapeType="roundedRect";let t=s.nodeX=p,e=s.nodeY=n,o=s.options.width||a.width||c,i=s.options.height||a.height||d;h=it(rt("object"==typeof l?l.radius:l||0,o),0,d/2);r.inverted&&(t=p-c,e=r.plotSizeY-n-d,o=s.options.height||a.height||c,i=s.options.width||a.width||d),s.dlOptions=W.getDLOptions({level:this.mapOptionsToLevel[s.level],optionsPoint:s.options}),s.plotX=1,s.plotY=1,s.tooltipPos=r.inverted?[r.plotSizeY-e-i/2,r.plotSizeX-t-o/2]:[t+o/2,e+i/2],s.shapeArgs={x:t,y:e,width:o,height:i,r:h,display:s.hasShape()?"":"none"}}else s.dlOptions={enabled:!1}}}W.defaultOptions=nt(O.defaultOptions,m),p.compose(u,W),st(W.prototype,{animate:tt.prototype.animate,createNode:p.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to","weight"],pointClass:u,searchPoint:e().noop}),s().registerSeriesType("sankey",W);const lt=e();return t.default})());