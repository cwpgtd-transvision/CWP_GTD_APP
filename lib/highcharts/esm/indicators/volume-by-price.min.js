import*as e from"../highcharts.js";import"../modules/stock.js";var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var s in o)t.o(o,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:o[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};let s=e.default;var o=t.n(s);t.d({},{});let i=e.default.SeriesRegistry;var a=t.n(i);let{prototype:{pointClass:n}}=a().seriesTypes["sma"],r=class extends n{destroy(){this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),super.destroy.apply(this,arguments)}},l=o()["animObject"],p=o()["noop"],{column:{prototype:h},sma:d}=a().seriesTypes,{addEvent:u,arrayMax:m,arrayMin:c,correctFloat:g,defined:v,error:f,extend:y,isArray:x,merge:D}=o(),V=Math.abs;class S extends d{init(o,e){let s=this,i=(delete e.data,super.init.apply(s,arguments),u(this.chart.constructor,"afterLinkSeries",function(){var e,t;s.options&&(t=s.options.params,e=s.linkedParent,t=o.get(t.volumeSeriesID),s.addCustomEvents(e,t)),i()},{order:1}));return s}addCustomEvents(e,t){let o=this,s=()=>{o.chart.redraw(),o.setData([]),o.zoneStarts=[],o.zoneLinesSVG&&(o.zoneLinesSVG=o.zoneLinesSVG.destroy())};return o.dataEventsToUnbind.push(u(e,"remove",function(){s()})),t&&o.dataEventsToUnbind.push(u(t,"remove",function(){s()})),o}animate(e){let o=this,t=o.chart.inverted,s=o.group,i={};!e&&s&&(e=t?o.yAxis.top:o.xAxis.left,t?(s["forceAnimate:translateY"]=!0,i.translateY=e):(s["forceAnimate:translateX"]=!0,i.translateX=e),s.animate(i,y(l(o.options.animation),{step:function(e,t){o.group.attr({scaleX:Math.max(.001,t.pos)})}})))}drawPoints(){this.options.volumeDivision.enabled&&(this.posNegVolume(!0,!0),h.drawPoints.apply(this,arguments),this.posNegVolume(!1,!1)),h.drawPoints.apply(this,arguments)}posNegVolume(e,t){let o=t?["positive","negative"]:["negative","positive"],s=this.options.volumeDivision,i=this.points.length,a=[],n=[],r=0,l,p,h,d;for(e?(this.posWidths=a,this.negWidths=n):(a=this.posWidths,n=this.negWidths);r<i;r++)(d=this.points[r])[o[0]+"Graphic"]=d.graphic,d.graphic=d[o[1]+"Graphic"],e&&(l=d.shapeArgs.width,(h=(p=this.priceZones[r]).wholeVolumeData)?(a.push(l/h*p.positiveVolumeData),n.push(l/h*p.negativeVolumeData)):(a.push(0),n.push(0))),d.color=t?s.styles.positiveColor:s.styles.negativeColor,d.shapeArgs.width=(t?this.posWidths:this.negWidths)[r],d.shapeArgs.x=t?d.shapeArgs.x:this.posWidths[r]}translate(){let o=this,e=o.options,t=o.chart,s=o.yAxis,i=s.min,a=o.options.zoneLines,n=o.priceZones,r=0,l,p,d,u,c,v,f,y,x,D,S=(h.translate.apply(o),o.points);S.length&&(f=e.pointPadding<.5?e.pointPadding:.1,l=m(o.volumeDataArray),p=t.plotWidth/2,y=t.plotTop,d=V(s.toPixels(i)-s.toPixels(i+o.rangeStep)),c=V(s.toPixels(i)-s.toPixels(i+o.rangeStep)),f&&(u=V(d*(1-2*f)),r=V((d-u)/2),d=V(u)),S.forEach(function(e,t){x=e.barX=e.plotX=0,D=e.plotY=s.toPixels(n[t].start)-y-(s.reversed?d-c:d)-r,e.pointWidth=v=g(p*n[t].wholeVolumeData/l),e.shapeArgs=o.crispCol.apply(o,[0,D,v,d]),e.volumeNeg=n[t].negativeVolumeData,e.volumePos=n[t].positiveVolumeData,e.volumeAll=n[t].wholeVolumeData}),a.enabled&&o.drawZones(t,s,o.zoneStarts,a.styles))}getExtremes(){let e,t=this.options.compare,o=this.options.cumulative;return this.options.compare?(this.options.compare=void 0,e=super.getExtremes(),this.options.compare=t):this.options.cumulative?(this.options.cumulative=!1,e=super.getExtremes(),this.options.cumulative=o):e=super.getExtremes(),e}getValues(e,t){let o=e.getColumn("x",!0),s=e.processedYData,i=this.chart,a=t.ranges,n=[],r=[],l=[],p=i.get(t.volumeSeriesID);if(e.chart){var h;if(!p||!p.getColumn("x",!0).length)return h=p&&!p.getColumn("x",!0).length?" does not contain any data.":" not found! Check `volumeSeriesID`.",void f("Series "+t.volumeSeriesID+h,!0,i);t=x(s[0]);return t&&4!==s[0].length?void f("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,i):((this.priceZones=this.specifyZones(t,o,s,a,p)).forEach(function(e,t){n.push([e.x,e.end]),r.push(n[t][0]),l.push(n[t][1])}),{values:n,xData:r,yData:l})}f("Base series not found! In case it has been removed, add a new one.",!0,i)}specifyZones(e,t,o,s,i){let a=!!e&&function(e){let t=e.length,o=e[0][3],s=o,i=1,a;for(;i<t;i++)(a=e[i][3])<o&&(o=a),a>s&&(s=a);return{min:o,max:s}}(o),n=this.zoneStarts=[],r=[],l=a?a.min:c(o),p=a?a.max:m(o),h=0,d=1,u=this.linkedParent;if(!this.options.compareToMain&&u.dataModify&&(l=u.dataModify.modifyValue(l),p=u.dataModify.modifyValue(p)),!v(l)||!v(p))return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG&&(this.zoneLinesSVG=this.zoneLinesSVG.destroy())),[];var f=this.rangeStep=g(p-l)/s;for(n.push(l);h<s-1;h++)n.push(g(n[h]+f));n.push(p);for(var y=n.length;d<y;d++)r.push({index:d-1,x:t[0],start:n[d-1],end:n[d]});return this.volumePerZone(e,r,i,t,o)}volumePerZone(o,e,t,s,i){let a,n,r,l,p,h=this,d=t.getColumn("x",!0),u=t.getColumn("y",!0),m=e.length-1,c=i.length,g=u.length;return V(c-g)&&(s[0]!==d[0]&&u.unshift(0),s[c-1]!==d[g-1]&&u.push(0)),h.volumeDataArray=[],e.forEach(function(t){for(p=0,t.wholeVolumeData=0,t.positiveVolumeData=0,t.negativeVolumeData=0;p<c;p++){n=!1,r=!1,l=o?i[p][3]:i[p],a=p?o?i[p-1][3]:i[p-1]:l;let e=h.linkedParent;!h.options.compareToMain&&e.dataModify&&(l=e.dataModify.modifyValue(l),a=e.dataModify.modifyValue(a)),l<=t.start&&0===t.index&&(n=!0),l>=t.end&&t.index===m&&(r=!0),(l>t.start||n)&&(l<t.end||r)&&(t.wholeVolumeData+=u[p],a>l?t.negativeVolumeData+=u[p]:t.positiveVolumeData+=u[p])}h.volumeDataArray.push(t.wholeVolumeData)}),e}drawZones(t,o,e,s){let i=t.renderer,a=t.plotWidth,n=t.plotTop,r=this.zoneLinesSVG,l=[],p;e.forEach(function(e){p=o.toPixels(e)-n,l=l.concat(t.renderer.crispLine([["M",0,p],["L",a,p]],s.lineWidth))}),r?r.animate({d:l}):r=this.zoneLinesSVG=i.path(l).attr({"stroke-width":s.lineWidth,stroke:s.color,dashstyle:s.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)}}S.defaultOptions=D(d.defaultOptions,{params:{index:void 0,period:void 0,ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{align:"left",allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"0.5em"},verticalAlign:"top"}}),y(S.prototype,{nameBase:"Volume by Price",nameComponents:["ranges"],calculateOn:{chart:"render",xAxis:"afterSetExtremes"},pointClass:r,markerAttribs:p,drawGraph:p,getColumnMetrics:h.getColumnMetrics,crispCol:h.crispCol}),a().registerSeriesType("vbp",S);let P=o();export{P as default};