import*as __WEBPACK_EXTERNAL_MODULE__highcharts_src_js_8202131d__ from"../highcharts.src.js";import*as __WEBPACK_EXTERNAL_MODULE__modules_stock_src_js_b3d80146__ from"../modules/stock.src.js";var __webpack_require__={n:e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},d:(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const external_highcharts_src_js_default_namespaceObject=__WEBPACK_EXTERNAL_MODULE__highcharts_src_js_8202131d__.default;var external_highcharts_src_js_default_default=__webpack_require__.n(external_highcharts_src_js_default_namespaceObject),x=e=>{var t={};return __webpack_require__.d(t,e),t},y=e=>()=>e;const stock_src_js_namespaceObject=x({}),external_highcharts_src_js_default_SeriesRegistry_namespaceObject=__WEBPACK_EXTERNAL_MODULE__highcharts_src_js_8202131d__.default.SeriesRegistry;var external_highcharts_src_js_default_SeriesRegistry_default=__webpack_require__.n(external_highcharts_src_js_default_SeriesRegistry_namespaceObject);const{prototype:{pointClass:SMAPoint}}=external_highcharts_src_js_default_SeriesRegistry_default().seriesTypes["sma"];class VBPPoint extends SMAPoint{destroy(){this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),super.destroy.apply(this,arguments)}}const VBP_VBPPoint=VBPPoint,animObject=external_highcharts_src_js_default_default()["animObject"],noop=external_highcharts_src_js_default_default()["noop"],{column:{prototype:columnProto},sma:SMAIndicator}=external_highcharts_src_js_default_SeriesRegistry_default().seriesTypes,{addEvent,arrayMax,arrayMin,correctFloat,defined,error,extend,isArray,merge}=external_highcharts_src_js_default_default(),abs=Math.abs;function arrayExtremesOHLC(e){var t=e.length;let a=e[0][3],s=a,o=1,r;for(;o<t;o++)(r=e[o][3])<a&&(a=r),r>s&&(s=r);return{min:a,max:s}}class VBPIndicator extends SMAIndicator{init(a,e){const s=this,o=(delete e.data,super.init.apply(s,arguments),addEvent(this.chart.constructor,"afterLinkSeries",function(){var e,t;s.options&&(t=s.options.params,e=s.linkedParent,t=a.get(t.volumeSeriesID),s.addCustomEvents(e,t)),o()},{order:1}));return s}addCustomEvents(e,t){const a=this,s=()=>{a.chart.redraw(),a.setData([]),a.zoneStarts=[],a.zoneLinesSVG&&(a.zoneLinesSVG=a.zoneLinesSVG.destroy())};return a.dataEventsToUnbind.push(addEvent(e,"remove",function(){s()})),t&&a.dataEventsToUnbind.push(addEvent(t,"remove",function(){s()})),a}animate(e){const a=this,t=a.chart.inverted,s=a.group,o={};!e&&s&&(e=t?a.yAxis.top:a.xAxis.left,t?(s["forceAnimate:translateY"]=!0,o.translateY=e):(s["forceAnimate:translateX"]=!0,o.translateX=e),s.animate(o,extend(animObject(a.options.animation),{step:function(e,t){a.group.attr({scaleX:Math.max(.001,t.pos)})}})))}drawPoints(){var e=this;e.options.volumeDivision.enabled&&(e.posNegVolume(!0,!0),columnProto.drawPoints.apply(e,arguments),e.posNegVolume(!1,!1)),columnProto.drawPoints.apply(e,arguments)}posNegVolume(e,t){var a=this,s=t?["positive","negative"]:["negative","positive"],o=a.options.volumeDivision,r=a.points.length;let i=[],n=[],l=0,c,d,p,h;for(e?(a.posWidths=i,a.negWidths=n):(i=a.posWidths,n=a.negWidths);l<r;l++)(h=a.points[l])[s[0]+"Graphic"]=h.graphic,h.graphic=h[s[1]+"Graphic"],e&&(c=h.shapeArgs.width,(p=(d=a.priceZones[l]).wholeVolumeData)?(i.push(c/p*d.positiveVolumeData),n.push(c/p*d.negativeVolumeData)):(i.push(0),n.push(0))),h.color=t?o.styles.positiveColor:o.styles.negativeColor,h.shapeArgs.width=(t?a.posWidths:a.negWidths)[l],h.shapeArgs.x=t?h.shapeArgs.x:a.posWidths[l]}translate(){const a=this,e=a.options,t=a.chart,s=a.yAxis,o=s.min,r=a.options.zoneLines,i=a.priceZones;let n=0,l,c,d,p,h,_,u,m,g,f,v;columnProto.translate.apply(a);const y=a.points;y.length&&(m=e.pointPadding<.5?e.pointPadding:.1,l=a.volumeDataArray,c=arrayMax(l),d=t.plotWidth/2,g=t.plotTop,p=abs(s.toPixels(o)-s.toPixels(o+a.rangeStep)),_=abs(s.toPixels(o)-s.toPixels(o+a.rangeStep)),m&&(h=abs(p*(1-2*m)),n=abs((p-h)/2),p=abs(h)),y.forEach(function(e,t){f=e.barX=e.plotX=0,v=e.plotY=s.toPixels(i[t].start)-g-(s.reversed?p-_:p)-n,u=correctFloat(d*i[t].wholeVolumeData/c),e.pointWidth=u,e.shapeArgs=a.crispCol.apply(a,[0,v,u,p]),e.volumeNeg=i[t].negativeVolumeData,e.volumePos=i[t].positiveVolumeData,e.volumeAll=i[t].wholeVolumeData}),r.enabled&&a.drawZones(t,s,a.zoneStarts,r.styles))}getExtremes(){var e=this.options.compare,t=this.options.cumulative;let a;return this.options.compare?(this.options.compare=void 0,a=super.getExtremes(),this.options.compare=e):this.options.cumulative?(this.options.cumulative=!1,a=super.getExtremes(),this.options.cumulative=t):a=super.getExtremes(),a}getValues(e,t){const a=e.getColumn("x",!0),s=e.processedYData,o=this.chart,r=t.ranges,i=[],n=[],l=[],c=o.get(t.volumeSeriesID);if(e.chart){var d;if(!c||!c.getColumn("x",!0).length)return d=c&&!c.getColumn("x",!0).length?" does not contain any data.":" not found! Check `volumeSeriesID`.",void error("Series "+t.volumeSeriesID+d,!0,o);t=isArray(s[0]);if(!t||4===s[0].length){const p=this.priceZones=this.specifyZones(t,a,s,r,c);return p.forEach(function(e,t){i.push([e.x,e.end]),n.push(i[t][0]),l.push(i[t][1])}),{values:i,xData:n,yData:l}}error("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,o)}else error("Base series not found! In case it has been removed, add a new one.",!0,o)}specifyZones(e,t,a,s,o){const r=this,i=!!e&&arrayExtremesOHLC(a),n=r.zoneStarts=[],l=[];let c=i?i.min:arrayMin(a),d=i?i.max:arrayMax(a),p=0,h=1;const _=r.linkedParent;if(!r.options.compareToMain&&_.dataModify&&(c=_.dataModify.modifyValue(c),d=_.dataModify.modifyValue(d)),!defined(c)||!defined(d))return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG&&(this.zoneLinesSVG=this.zoneLinesSVG.destroy())),[];var u=r.rangeStep=correctFloat(d-c)/s;for(n.push(c);p<s-1;p++)n.push(correctFloat(n[p]+u));n.push(d);for(var m=n.length;h<m;h++)l.push({index:h-1,x:t[0],start:n[h-1],end:n[h]});return r.volumePerZone(e,l,o,t,a)}volumePerZone(a,e,t,s,o){const r=this,i=t.getColumn("x",!0),n=t.getColumn("y",!0),l=e.length-1,c=o.length,d=n.length;let p,h,_,u,m;return abs(c-d)&&(s[0]!==i[0]&&n.unshift(0),s[c-1]!==i[d-1]&&n.push(0)),r.volumeDataArray=[],e.forEach(function(e){for(e.wholeVolumeData=0,e.positiveVolumeData=0,e.negativeVolumeData=0,m=0;m<c;m++){h=!1,_=!1,u=a?o[m][3]:o[m],p=m?a?o[m-1][3]:o[m-1]:u;const t=r.linkedParent;!r.options.compareToMain&&t.dataModify&&(u=t.dataModify.modifyValue(u),p=t.dataModify.modifyValue(p)),u<=e.start&&0===e.index&&(h=!0),u>=e.end&&e.index===l&&(_=!0),(u>e.start||h)&&(u<e.end||_)&&(e.wholeVolumeData+=n[m],p>u?e.negativeVolumeData+=n[m]:e.positiveVolumeData+=n[m])}r.volumeDataArray.push(e.wholeVolumeData)}),e}drawZones(t,a,e,s){const o=t.renderer,r=t.plotWidth,i=t.plotTop;let n=this.zoneLinesSVG,l=[],c;e.forEach(function(e){c=a.toPixels(e)-i,l=l.concat(t.renderer.crispLine([["M",0,c],["L",r,c]],s.lineWidth))}),n?n.animate({d:l}):n=this.zoneLinesSVG=o.path(l).attr({"stroke-width":s.lineWidth,stroke:s.color,dashstyle:s.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)}}VBPIndicator.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{index:void 0,period:void 0,ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{align:"left",allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"0.5em"},verticalAlign:"top"}}),extend(VBPIndicator.prototype,{nameBase:"Volume by Price",nameComponents:["ranges"],calculateOn:{chart:"render",xAxis:"afterSetExtremes"},pointClass:VBP_VBPPoint,markerAttribs:noop,drawGraph:noop,getColumnMetrics:columnProto.getColumnMetrics,crispCol:columnProto.crispCol}),external_highcharts_src_js_default_SeriesRegistry_default().registerSeriesType("vbp",VBPIndicator);const VBP_VBPIndicator=null,volume_by_price_src=external_highcharts_src_js_default_default();export{volume_by_price_src as default};