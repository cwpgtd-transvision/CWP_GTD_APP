import*as o from"../highcharts.js";import"../modules/stock.js";var e={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return e.d(t,{a:t}),t},d:(o,t)=>{for(var l in t)e.o(t,l)&&!e.o(o,l)&&Object.defineProperty(o,l,{enumerable:!0,get:t[l]})},o:(o,e)=>Object.prototype.hasOwnProperty.call(o,e)};let l=o.default;var t=e.n(l);e.d({},{});let r=o.default.SeriesRegistry;var s=e.n(r);let{atr:n,sma:i}=s().seriesTypes,{addEvent:p,correctFloat:a,isArray:d,isNumber:c,extend:h,merge:u,objectEach:g}=t();function x(o,e){return{index:e,close:o.getColumn("close")[e],x:o.getColumn("x")[e]}}class y extends i{init(){let e=this,o=(super.init.apply(e,arguments),p(this.chart.constructor,"afterLinkSeries",()=>{if(e.options){let o=e.options;o.cropThreshold=e.linkedParent.options.cropThreshold-(o.params.period-1)}o()},{order:1}))}drawGraph(){let t=this,o=t.options,e=t.linkedParent,l=e.getColumn("x"),r=e?e.points:[],n=t.points,s=t.graph,p=r.length-n.length,a=0<p?p:0,d={options:{gapSize:o.gapSize}},h={top:[],bottom:[],intersect:[]},y={top:{styles:{lineWidth:o.lineWidth,lineColor:o.fallingTrendColor||o.color,dashStyle:o.dashStyle}},bottom:{styles:{lineWidth:o.lineWidth,lineColor:o.risingTrendColor||o.color,dashStyle:o.dashStyle}},intersect:o.changeTrendLine},m,f,C,T,b,S,v,D,L,N=n.length;for(;N--;)m=n[N],f=n[N-1],C=r[N-1+a],T=r[N-2+a],b=r[N+a],S=r[N+a+1],v=m.options.color,D={x:m.x,plotX:m.plotX,plotY:m.plotY,isNull:!1},!T&&C&&c(l[C.index-1])&&(T=x(e,C.index-1)),!S&&b&&c(l[b.index+1])&&(S=x(e,b.index+1)),!C&&T&&c(l[T.index+1])?C=x(e,T.index+1):!C&&b&&c(l[b.index-1])&&(C=x(e,b.index-1)),m&&C&&b&&T&&m.x!==C.x&&(m.x===b.x?(T=C,C=b):m.x===T.x?(C=T,T={close:e.getColumn("close")[C.index-1],x:l[C.index-1]}):S&&m.x===S.x&&(C=S,T=b)),f&&T&&C?(L={x:f.x,plotX:f.plotX,plotY:f.plotY,isNull:!1},m.y>=C.close&&f.y>=T.close?(m.color=v||o.fallingTrendColor||o.color,h.top.push(D)):m.y<C.close&&f.y<T.close?(m.color=v||o.risingTrendColor||o.color,h.bottom.push(D)):(h.intersect.push(D),h.intersect.push(L),h.intersect.push(u(L,{isNull:!0})),m.y>=C.close&&f.y<T.close?(m.color=v||o.fallingTrendColor||o.color,f.color=v||o.risingTrendColor||o.color,h.top.push(D),h.top.push(u(L,{isNull:!0}))):m.y<C.close&&f.y>=T.close&&(m.color=v||o.risingTrendColor||o.color,f.color=v||o.fallingTrendColor||o.color,h.bottom.push(D),h.bottom.push(u(L,{isNull:!0}))))):C&&(m.y>=C.close?(m.color=v||o.fallingTrendColor||o.color,h.top.push(D)):(m.color=v||o.risingTrendColor||o.color,h.bottom.push(D)));g(h,function(o,e){t.points=o,t.options=u(y[e].styles,d),t.graph=t["graph"+e+"Line"],i.prototype.drawGraph.call(t),t["graph"+e+"Line"]=t.graph}),t.points=n,t.options=o,t.graph=s}getValues(o,e){let t=e.period,l=e.multiplier,r=o.xData,i=o.yData,s=[],p=[],c=[],h=0===t?0:t-1,u=[],g=[],x,y,m,f,C,T,b,S,v,D;if(!(r.length<=t)&&d(i[0])&&4===i[0].length&&!(t<0)){for(D=0,x=n.prototype.getValues.call(this,o,{period:t}).yData;D<x.length;D++)v=i[h+D],S=i[h+D-1]||[],C=u[D-1],T=g[D-1],b=c[D-1],0===D&&(C=T=b=0),y=a((v[1]+v[2])/2+l*x[D]),m=a((v[1]+v[2])/2-l*x[D]),y<C||S[3]>C?u[D]=y:u[D]=C,m>T||S[3]<T?g[D]=m:g[D]=T,b===C&&v[3]<u[D]||b===T&&v[3]<g[D]?f=u[D]:(b===C&&v[3]>u[D]||b===T&&v[3]>g[D])&&(f=g[D]),s.push([r[h+D],f]),p.push(r[h+D]),c.push(f);return{values:s,xData:p,yData:c}}}}y.defaultOptions=u(i.defaultOptions,{params:{index:void 0,multiplier:3,period:10},risingTrendColor:"#06b535",fallingTrendColor:"#f21313",changeTrendLine:{styles:{lineWidth:1,lineColor:"#333333",dashStyle:"LongDash"}}}),h(y.prototype,{nameBase:"Supertrend",nameComponents:["multiplier","period"]}),s().registerSeriesType("supertrend",y);let m=t();export{m as default};