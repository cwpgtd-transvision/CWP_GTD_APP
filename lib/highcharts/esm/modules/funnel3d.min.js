import*as t from"../highcharts.js";import"../highcharts-3d.js";import"./cylinder.js";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};let i=t.default;var r=e.n(i);let o=t.default.Color;var n=e.n(o);let s=t.default.RendererRegistry;var d=e.n(s);let h=n()["parse"],a=r()["charts"],l=d().getRendererType().prototype["Element3D"],p=r()["merge"],g=class extends l{constructor(){super(...arguments),this.mainParts=["top","bottom"],this.parts=["top","bottom","frontUpper","backUpper","frontLower","backLower","rightUpper","rightLower"],this.sideGroups=["upperGroup","lowerGroup"],this.sideParts={upperGroup:["frontUpper","backUpper","rightUpper"],lowerGroup:["frontLower","backLower","rightLower"]},this.pathType="funnel3d"}opacitySetter(t){let e=parseFloat(t),r=this.parts,i=a[this.renderer.chartIndex],o="group-opacity-"+e+"-"+i.index;if(this.parts=this.mainParts,this.singleSetterForParts("opacity",e),this.parts=r,!i.renderer.filterId){for(var n of(i.renderer.definition({tagName:"filter",attributes:{id:o},children:[{tagName:"feComponentTransfer",children:[{tagName:"feFuncA",attributes:{type:"table",tableValues:"0 "+e}}]}]}),this.sideGroups))this[n].attr({filter:"url(#"+o+")"});if(this.renderer.styledMode)for(var s of(i.renderer.definition({tagName:"style",textContent:".highcharts-"+o+" {filter:url(#"+o+")}"}),this.sideGroups))this[s].addClass("highcharts-"+o)}return this}fillSetter(t){let e=h(t),r=e.rgba[3],i={top:h(t).brighten(.1).get(),bottom:h(t).brighten(-.2).get()};if(r<1?(e.rgba[3]=1,e=e.get("rgb"),this.attr({opacity:r})):e=t,(e=e.linearGradient||e.radialGradient||!this.gradientForSides?e:{linearGradient:{x1:0,x2:1,y1:1,y2:1},stops:[[0,h(t).brighten(-.2).get()],[.5,t],[1,h(t).brighten(-.2).get()]]}).linearGradient)for(var o of this.sideGroups){var n,s=this[o].gradientBox,d=e.linearGradient,a=p(e,{linearGradient:{x1:s.x+d.x1*s.width,y1:s.y+d.y1*s.height,x2:s.x+d.x2*s.width,y2:s.y+d.y2*s.height}});for(n of this.sideParts[o])i[n]=a}else if(p(!0,i,{frontUpper:e,backUpper:e,rightUpper:e,frontLower:e,backLower:e,rightLower:e}),e.radialGradient)for(var l of this.sideGroups){var g,c=this[l].gradientBox,y=c.x+c.width/2,f=c.y+c.height/2,u=Math.min(c.width,c.height);for(g of this.sideParts[l])this[g].setRadialReference([y,f,u])}if(this.singleSetterForParts("fill",null,i),this.color=this.fill=t,e.linearGradient)for(var x of[this.frontLower,this.frontUpper]){let t=x.element,e=t&&this.renderer.gradients[t.gradient];e&&"userSpaceOnUse"!==e.attr("gradientUnits")&&e.attr({gradientUnits:"userSpaceOnUse"})}return this}adjustForGradient(){var r;for(r of this.sideGroups){let t={x:Number.MAX_VALUE,y:Number.MAX_VALUE},e={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE};for(var i of this.sideParts[r])i=this[i].getBBox(!0),t={x:Math.min(t.x,i.x),y:Math.min(t.y,i.y)},e={x:Math.max(e.x,i.x+i.width),y:Math.max(e.y,i.y+i.height)};this[r].gradientBox={x:t.x,width:e.x-t.x,y:t.y,height:e.y-t.y}}}zIndexSetter(){return this.finishedOnAdd&&this.adjustForGradient(),this.renderer.Element.prototype.zIndexSetter.apply(this,arguments)}onAdd(){this.adjustForGradient(),this.finishedOnAdd=!0}},c=r()["charts"],{error:y,extend:f,merge:u}=r();function x(t){let e=this.element3d("funnel3d",t),r=this.styledMode,i={"stroke-width":1,stroke:"none"};for(var o of(e.upperGroup=this.g("funnel3d-upper-group").attr({zIndex:e.frontUpper.zIndex}).add(e),[e.frontUpper,e.backUpper,e.rightUpper]))r||o.attr(i),o.add(e.upperGroup);for(var n of(e.lowerGroup=this.g("funnel3d-lower-group").attr({zIndex:e.frontLower.zIndex}).add(e),[e.frontLower,e.backLower,e.rightLower]))r||n.attr(i),n.add(e.lowerGroup);return e.gradientForSides=t.gradientForSides,e}function w(t){this.getCylinderEnd||y("A required Highcharts module is missing: cylinder.js",!0,c[this.chartIndex]);let e=c[this.chartIndex],r=t.alphaCorrection=90-Math.abs(e.options.chart.options3d.alpha%180-90),i=this.cuboidPath.call(this,u(t,{depth:t.width,width:(t.width+t.bottom.width)/2})),o=i.isTop,n=!i.isFront,s=!!t.middle,d=this.getCylinderEnd(e,u(t,{x:t.x-t.width/2,z:t.z-t.width/2,alphaCorrection:r})),a=t.bottom.width,h=u(t,{width:a,x:t.x-a/2,z:t.z-a/2,alphaCorrection:r}),l=this.getCylinderEnd(e,h,!0),p=a,g=h,f=l,x=l,w,m=(s&&(p=t.middle.width,g=u(t,{y:t.y+t.middle.fraction*t.height,width:p,x:t.x-p/2,z:t.z-p/2}),f=this.getCylinderEnd(e,g,!1),x=this.getCylinderEnd(e,g,!1)),{top:d,bottom:l,frontUpper:this.getCylinderFront(d,f),zIndexes:{group:i.zIndexes.group,top:3*(0===o),bottom:3*(1===o),frontUpper:n?2:1,backUpper:n?1:2,rightUpper:n?2:1}});return m.backUpper=this.getCylinderBack(d,f),w=Math.min(p,t.width)/Math.max(p,t.width)!=1,m.rightUpper=this.getCylinderFront(this.getCylinderEnd(e,u(t,{x:t.x-t.width/2,z:t.z-t.width/2,alphaCorrection:w?-r:0}),!1),this.getCylinderEnd(e,u(g,{alphaCorrection:w?-r:0}),!s)),s&&(w=Math.min(p,a)/Math.max(p,a)!=1,u(!0,m,{frontLower:this.getCylinderFront(x,l),backLower:this.getCylinderBack(x,l),rightLower:this.getCylinderFront(this.getCylinderEnd(e,u(h,{alphaCorrection:w?-r:0}),!0),this.getCylinderEnd(e,u(g,{alphaCorrection:w?-r:0}),!1)),zIndexes:{frontLower:n?2:1,backLower:n?1:2,rightLower:n?1:2}})),m}let m=t.default.SeriesRegistry;var b=e.n(m);let{column:A}=b()["seriesTypes"],z=r()["extend"];class L extends A.prototype.pointClass{}z(L.prototype,{shapeType:"funnel3d"});let C=r()["deg2rad"],U=r()["pick"];function v(t,e,r,i){let o=e.options.chart.options3d,n=U(i,!!r&&e.inverted),s={x:e.plotWidth/2,y:e.plotHeight/2,z:o.depth/2,vd:U(o.depth,1)*U(o.viewDistance,0)},d=e.scale3d||1,a=C*o.beta*(n?-1:1),h=C*o.alpha*(n?-1:1),l={cosA:Math.cos(h),cosB:Math.cos(-a),sinA:Math.sin(h),sinB:Math.sin(-a)};return r||(s.x+=e.plotLeft,s.y+=e.plotTop),t.map(function(t){var e,r;e=(n?t.y:t.x)-s.x,r=(n?t.x:t.y)-s.y,t=(t.z||0)-s.z;let i={x:l.cosB*e-l.sinB*t,y:-l.sinA*l.sinB*e+l.cosA*r-l.cosB*l.sinA*t,z:l.cosA*l.sinB*e+l.sinA*r+l.cosA*l.cosB*t},o=G(i,s,s.vd);return o.x=o.x*d+s.x,o.y=o.y*d+s.y,o.z=i.z*d+s.z,{x:n?o.y:o.x,y:n?o.x:o.y,z:o.z}})}function G(t,e,r){e=0<r&&r<Number.POSITIVE_INFINITY?r/(t.z+e.z+r):1;return{x:t.x*e,y:t.y*e}}function M(t){let e=0,r,i;for(r=0;r<t.length;r++)i=(r+1)%t.length,e+=t[r].x*t[i].y-t[i].x*t[r].y;return e/2}let k=r()["noop"],F={perspective:v}["perspective"],{series:B,seriesTypes:{column:I}}=b(),{extend:S,merge:E,pick:P,relativeLength:T}=r();class W extends I{alignDataLabel(t,e,r){let i=t.dlBoxRaw,o=this.chart.inverted,n=t.plotY>P(this.translatedThreshold,this.yAxis.len),s=P(r.inside,!!this.options.stacking),d={x:i.x,y:i.y,height:0};r.align=P(r.align,!o||s?"center":n?"right":"left"),r.verticalAlign=P(r.verticalAlign,o||s?"middle":n?"top":"bottom"),"top"!==r.verticalAlign&&(d.y+=i.bottom/("bottom"===r.verticalAlign?1:2)),d.width=this.getWidthAt(d.y),this.options.reversed&&(d.width=i.fullWidth-d.width),s?d.x-=d.width/2:"left"===r.align?(r.align="right",d.x-=1.5*d.width):"right"===r.align?(r.align="left",d.x+=d.width/2):d.x-=d.width/2,t.dlBox=d,I.prototype.alignDataLabel.apply(this,arguments)}bindAxes(){B.prototype.bindAxes.apply(this,arguments),S(this.xAxis.options,{gridLineWidth:0,lineWidth:0,title:void 0,tickPositions:[]}),E(!0,this.yAxis.options,{gridLineWidth:0,title:void 0,labels:{enabled:!1}})}translate(){B.prototype.translate.apply(this,arguments);let t=this.chart,e=this.options,r=e.reversed,i=e.ignoreHiddenPoint,o=t.plotWidth,n=t.plotHeight,s=e.center,d=T(s[0],o),a=T(s[1],n),h=T(e.width,o),l=T(e.height,n),p=T(e.neckWidth,o),g=T(e.neckHeight,n),c=a-l/2+l-g,y=this.points,f=0,u=0,x,w,m,b,v,A,L,z,C;for(var U of(this.getWidthAt=w=function(t){return t>c||l===g?p:p+(h-p)*(1-(t-(a-l/2))/(l-g))},this.center=[d,a,l],this.centerX=d,y))i&&!1===U.visible||(f+=U.y);for(var G of y)L=null,m=f?G.y/f:0,A=(v=a-l/2+u*l)+m*l,x=w(v),z=A-v,(C={gradientForSides:P(G.options.gradientForSides,e.gradientForSides),x:d,y:v,height:z,width:x,z:1,top:{width:x}}).bottom={fraction:m,width:x=w(A)},v>=c?C.isCylinder=!0:A>c&&(L=A,x=w(c),A=c,C.bottom.width=x,C.middle={fraction:z?(c-v)/z:0,width:x}),r&&(C.y=v=a+l/2-(u+m)*l,C.middle&&(C.middle.fraction=1-(z?C.middle.fraction:0)),x=C.width,C.width=C.bottom.width,C.bottom.width=x),G.shapeArgs=S(G.shapeArgs,C),G.percentage=100*m,G.plotX=d,G.plotY=r?a+l/2-(u+m/2)*l:(v+(L||A))/2,b=F([{x:d,y:G.plotY,z:r?-(h-w(G.plotY))/2:-w(G.plotY)/2}],t,!0)[0],G.tooltipPos=[b.x,b.y],G.dlBoxRaw={x:d,width:w(G.plotY),y:v,bottom:C.height||0,fullWidth:h},i&&!1===G.visible||(u+=m)}}W.compose=function(t){let e=t.prototype;e.funnel3d||(e.Element3D.types.funnel3d=g,f(e,{funnel3d:x,funnel3dPath:w}))},W.defaultOptions=E(I.defaultOptions,{center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:!1,gradientForSides:!0,animation:!1,edgeWidth:0,colorByPoint:!0,showInLegend:!1,dataLabels:{align:"right",crop:!1,inside:!1,overflow:"allow"}}),S(W.prototype,{pointClass:L,translate3dShapes:k}),b().registerSeriesType("funnel3d",W),e.d({},{}),e.d({},{}),W.compose(d().getRendererType());let N=r();export{N as default};