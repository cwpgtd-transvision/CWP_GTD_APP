import*as t from"../highcharts.js";import"./sankey.js";var e,o,s={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},d:(t,e)=>{for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};let i=t.default;var n=s.n(i);s.d({},{});let a=t.default.SeriesRegistry;var r=s.n(a);let{prototype:l,prototype:{pointClass:{prototype:h}}}=r()["series"],{defined:d,extend:p,find:u,merge:c,pick:f}=n(),m=(!function(t){function i(){return this.data=[].concat(this.points||[],this.nodes),l.destroy.apply(this,arguments)}function n(){this.nodes&&(this.nodes.forEach(t=>{t.destroy()}),this.nodes.length=0),l.setData.apply(this,arguments)}function a(t){let e=arguments,o=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==t&&o.forEach(t=>{t&&t.series&&(h.setState.apply(t,e),t.isNode||(t.fromNode.graphic&&h.setState.apply(t.fromNode,e),t.toNode&&t.toNode.graphic&&h.setState.apply(t.toNode,e)))}),h.setState.apply(this,e)}function r(t,e,o,s){let i=this.series.options.nodes,n=this.series.options.data,a=n?.length||0,r=n?.[this.index];h.update.call(this,t,!this.isNode&&e,o,s),this.isNode&&(t=(i||[]).reduce((t,e,o)=>this.id===e.id?o:t,-1),s=c(i&&i[t]||{},n?.[this.index]||{}),n&&(r?n[this.index]=r:n.length=a),i?0<=t?i[t]=s:i.push(s):this.series.options.nodes=[s],f(e,!0)&&this.series.chart.redraw(o))}t.compose=function(t,e){let o=t.prototype,s=e.prototype;return o.setNodeState=a,o.setState=a,o.update=r,s.destroy=i,s.setData=n,e},t.createNode=function(t){let e=this.pointClass,o=(t,e)=>u(t,t=>t.id===e),s=o(this.nodes,t),n;if(!s){n=this.options.nodes&&o(this.options.nodes,t);let i=new e(this,p({className:"highcharts-node",isNode:!0,id:t,y:1},n));i.linksTo=[],i.linksFrom=[],i.getSum=function(){let e=0,o=0;return i.linksTo.forEach(t=>{e+=t.weight||0}),i.linksFrom.forEach(t=>{o+=t.weight||0}),Math.max(e,o)},i.offset=function(e,o){let s=0;for(let t=0;t<i[o].length;t++){if(i[o][t]===e)return s;s+=i[o][t].weight}},i.hasShape=function(){let e=0;return i.linksTo.forEach(t=>{t.outgoing&&e++}),!i.linksTo.length||e!==i.linksTo.length},i.index=this.nodes.push(i)-1,s=i}return s.formatPrefix="node",s.name=s.name||s.options.id||"",s.mass=f(s.options.mass,s.options.marker&&s.options.marker.radius,this.options.marker&&this.options.marker.radius,4),s},t.destroy=i,t.generatePoints=function(){let e=this.chart,o={};l.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(t=>{t.linksFrom.length=0,t.linksTo.length=0,t.level=t.options.level}),this.points.forEach(t=>{d(t.from)&&(o[t.from]||(o[t.from]=this.createNode(t.from)),o[t.from].linksFrom.push(t),t.fromNode=o[t.from],e.styledMode?t.colorIndex=f(t.options.colorIndex,o[t.from].colorIndex):t.color=t.options.color||o[t.from].color),d(t.to)&&(o[t.to]||(o[t.to]=this.createNode(t.to)),o[t.to].linksTo.push(t),t.toNode=o[t.to]),t.name=t.name||t.id},this),this.nodeLookup=o},t.setNodeState=a,t.updateNode=r}(e=e||{}),e),{sankey:{prototype:{pointClass:g}}}=r()["seriesTypes"],y=n()["extend"];class x extends g{isValid(){return!0}}y(x.prototype,{setState:m.setNodeState});let{defined:k,getAlignFactor:b,relativeLength:S}=n();var L=o=o||{};L.compose=function(t,e){return t.sankeyColumn=new P(t,e),t};class P{constructor(t,e){this.points=t,this.series=e}getTranslationFactor(t){let e=this.points,o=e.slice(),s=t.chart,i=t.options.minLinkWidth||0,n,a=0,r,h=(s.plotSizeY||0)-(t.options.borderWidth||0)-(e.length-1)*t.nodePadding;for(;e.length;){for(a=h/e.sankeyColumn.sum(),n=!1,r=e.length;r--;)e[r].getSum()*a<i&&(e.splice(r,1),h=Math.max(0,h-i),n=!0);if(!n)break}for(var l of(e.length=0,o))e.push(l);return a}top(o){let s=this.series,i=s.nodePadding,t=this.points.reduce((t,e)=>(0<t&&(t+=i),t+=Math.max(e.getSum()*o,s.options.minLinkWidth||0)),0);return b(s.options.nodeAlignment||"center")*((s.chart.plotSizeY||0)-t)}left(o){let s=this.series,t=s.chart,i=s.options.equalNodes,n=t.inverted?t.plotHeight:t.plotWidth,a=s.nodePadding,e=this.points.reduce((t,e)=>(0<t&&(t+=a),t+=i?n/e.series.nodes.length-a:Math.max(e.getSum()*o,s.options.minLinkWidth||0)),0);return((t.plotSizeX||0)-Math.round(e))/2}sum(){return this.points.reduce((t,e)=>t+e.getSum(),0)}offset(e,o){let s=this.points,i=this.series,n=i.nodePadding,a=0,r;if(i.is("organization")&&e.hangsFrom)return{absoluteTop:e.hangsFrom.nodeY};for(let t=0;t<s.length;t++){var h=s[t].getSum(),l=Math.max(h*o,i.options.minLinkWidth||0),d=e.options[i.chart.inverted?"offsetHorizontal":"offsetVertical"],p=e.options.offset||0;if(r=h?l+n:0,s[t]===e)return{relativeTop:a+(k(d)?S(d,l):S(p,r))};a+=r}}}L.SankeyColumnAdditions=P;let N=o,v=t.default.Series;var T=s.n(v);let C=t.default.SVGRenderer;var M=s.n(C);let W=t.default.SVGElement;var A=s.n(W);let O=n()["deg2rad"],{addEvent:w,merge:z,uniqueKey:Y,defined:E,extend:F}=n();function X(i,t){t=z(!0,{enabled:!0,attributes:{dy:-5,startOffset:"50%",textAnchor:"middle"}},t);let n=this.renderer.url,a=this.text||this,e=a.textPath,{attributes:r,enabled:h}=t;return i=i||e&&e.path,e&&e.undo(),i&&h?(t=w(a,"afterModifyTree",o=>{if(i&&h){let t=i.attr("id"),e=(t||i.attr("id",t=Y()),{x:0,y:0});E(r.dx)&&(e.dx=r.dx,delete r.dx),E(r.dy)&&(e.dy=r.dy,delete r.dy),a.attr(e),this.attr({transform:""}),this.box&&(this.box=this.box.destroy());var s=o.nodes.slice(0);o.nodes.length=0,o.nodes[0]={tagName:"textPath",attributes:F(r,{"text-anchor":r.textAnchor,href:n+"#"+t}),children:s}}}),a.textPath={path:i,undo:t}):(a.attr({dx:0,dy:0}),delete a.textPath),this.added&&(a.textCache="",this.renderer.buildText(a)),this}function B(l){let o=l.bBox,d=this.element?.querySelector("textPath");if(d){let s=[],{b:i,h:t}=this.renderer.fontMetrics(this.element),n=t-i,e=RegExp('(<tspan>|<tspan(?!\\sclass="highcharts-br")[^>]*>|<\\/tspan>)',"g"),a=d.innerHTML.replace(e,"").split(/<tspan class="highcharts-br"[^>]*>/),r=a.length,h=(t,e)=>{var{x:e,y:o}=e,t=(d.getRotationOfChar(t)-90)*O,s=Math.cos(t),t=Math.sin(t);return[[e-n*s,o-n*t],[e+i*s,o+i*t]]};for(let e=0,o=0;o<r;o++){var p=a[o].length;for(let t=0;t<p;t+=5)try{var u=e+t+o,[c,f]=h(u,d.getStartPositionOfChar(u));0===t?(s.push(f),s.push(c)):(0===o&&s.unshift(f),o===r-1&&s.push(c))}catch(l){break}e+=p-1;try{var m=e+o,g=d.getEndPositionOfChar(m),[y,x]=h(m,g);s.unshift(x),s.unshift(y)}catch(l){break}}s.length&&s.push(s[0].slice()),o.polygon=s}return o}function H(t){let e=t.labelOptions,o=t.point,s=e[o.formatPrefix+"TextPath"]||e.textPath;s&&!e.useHTML&&(this.setTextPath(o.getDataLabelPath?.(this)||o.graphic,s),o.dataLabelPath&&!s.enabled&&(o.dataLabelPath=o.dataLabelPath.destroy()))}!function(t){w(t,"afterGetBBox",B),w(t,"beforeAddingDataLabel",H);let e=t.prototype;e.setTextPath||(e.setTextPath=X)}(A());let{symbols:D}=M()["prototype"],{column:R,sankey:q}=r()["seriesTypes"],{crisp:j,extend:I,merge:V,pick:_,relativeLength:G}=n();class $ extends q{createNodeColumns(){let d=this,u=d.chart,c=N.compose([],d);return c.sankeyColumn.maxLength=u.inverted?u.plotHeight:u.plotWidth,c.sankeyColumn.getTranslationFactor=t=>{let e=c.slice(),o=this.options.minLinkWidth||0,s,i=0,n,a,r=0,h=1,l=0,d=(u.plotSizeX||0)-(t.options.marker&&t.options.marker.lineWidth||0)-(c.length-1)*t.nodePadding;for(;c.length;){for(i=d/c.sankeyColumn.sum(),s=!1,n=c.length;n--;){a=c[n].getSum()*i*h;var p=Math.min(u.plotHeight,u.plotWidth);a>p?h=Math.min(p/a,h):a<o&&(c.splice(n,1),d-=o,a=o,s=!0),l+=a*(1-h)/2,r=Math.max(r,a)}if(!s)break}return c.length=0,e.forEach(t=>{t.scale=h,c.push(t)}),c.sankeyColumn.maxRadius=r,c.sankeyColumn.scale=h,c.sankeyColumn.additionalSpace=l,i},c.sankeyColumn.offset=function(e,o){let s=e.series.options.equalNodes,i=d.nodePadding,n=Math.min(u.plotWidth,u.plotHeight,(c.sankeyColumn.maxLength||0)/d.nodes.length-i),a=c.sankeyColumn.additionalSpace||0,r;for(let t=0;t<c.length;t++){var h=c[t].getSum()*(c.sankeyColumn.scale||0),l=s?n:Math.max(h*o,d.options.minLinkWidth||0);if(r=h?l+i:0,c[t]===e)return{relativeLeft:a+G(e.options.offset||0,r)};a+=r}},d.nodes.forEach(function(t){t.column=0,c.push(t)}),[c]}translateLink(o){let t=o.fromNode,e=o.toNode,s=this.chart,i=this.translationFactor,n=o.options,a=this.options,r=_(n.linkWeight,a.linkWeight,Math.max((o.weight||0)*i*t.scale,this.options.minLinkWidth||0)),h=o.series.options.centeredLinks,l=t.nodeY,d=(t,e)=>{e=(t.offset(o,e)||0)*i;return Math.min(t.nodeX+e,t.nodeX+(t.shapeArgs&&t.shapeArgs.height||0)-r)},p=h?t.nodeX+((t.shapeArgs.height||0)-r)/2:d(t,"linksFrom"),u=h?e.nodeX+((e.shapeArgs.height||0)-r)/2:d(e,"linksTo"),c=l;p>u&&([p,u]=[u,p]),a.reversed&&([p,u]=[u,p],c=(s.plotSizeY||0)-c),o.shapeType="path",o.linkBase=[p,p+r,u,u+r];var f=(u+r-p)/Math.abs(u+r-p)*_(a.linkRadius,Math.min(Math.abs(u+r-p)/2,t.nodeY-Math.abs(r)));o.shapeArgs={d:[["M",p,c],["A",(u+r-p)/2,f,0,0,1,u+r,c],["L",u,c],["A",(u-p-r)/2,f-r,0,0,0,p+r,c],["Z"]]},o.dlBox={x:p+(u-p)/2,y:c-f,height:r,width:0},o.tooltipPos=s.inverted?[(s.plotSizeY||0)-o.dlBox.y-r/2,(s.plotSizeX||0)-o.dlBox.x]:[o.dlBox.x,o.dlBox.y+r/2],o.y=o.plotY=1,o.x=o.plotX=1,o.color||(o.color=t.color)}translateNode(s,t){var i=this.translationFactor,n=this.chart,a=n.inverted?n.plotWidth:n.plotHeight,r=this.options,a=Math.min(n.plotWidth,n.plotHeight,a/s.series.nodes.length-this.nodePadding),e=s.getSum()*(t.sankeyColumn.scale||0),a=r.equalNodes?a:Math.max(e*i,this.options.minLinkWidth||0),o=r.marker?.lineWidth||0,h=t.sankeyColumn.offset(s,i),i=j(_(h&&h.absoluteLeft,(t.sankeyColumn.left(i)||0)+(h&&h.relativeLeft||0)),o),h=V(r.marker,s.options.marker),l=h.symbol,d=h.radius,h=parseInt(r.offset,10)*((n.inverted?n.plotWidth:n.plotHeight)-(j(this.colDistance*(s.column||0)+(h.lineWidth||0)/2,o)+(t.sankeyColumn.scale||0)*(t.sankeyColumn.maxRadius||0)/2))/100;if(s.sum=e){s.nodeX=i,s.nodeY=h;let t=s.options.width||r.width||a,e=s.options.height||r.height||a,o=h;r.reversed&&(o=(n.plotSizeY||0)-h,n.inverted&&(o=(n.plotSizeY||0)-h)),this.mapOptionsToLevel&&(s.dlOptions=q.getDLOptions({level:this.mapOptionsToLevel[s.level],optionsPoint:s.options})),s.plotX=1,s.plotY=1,s.tooltipPos=n.inverted?[(n.plotSizeY||0)-o-e/2,(n.plotSizeX||0)-i-t/2]:[i+t/2,o+e/2],s.shapeType="path",s.shapeArgs={d:D[l||"circle"](i,o-(d||e)/2,d||t,d||e),width:d||t,height:d||e},s.dlBox={x:i+t/2,y:o,height:0,width:0}}else s.dlOptions={enabled:!1}}drawDataLabels(){var t;this.options.dataLabels&&(t=this.options.dataLabels.textPath,R.prototype.drawDataLabels.call(this,this.nodes),this.options.dataLabels.textPath=this.options.dataLabels.linkTextPath,R.prototype.drawDataLabels.call(this,this.data),this.options.dataLabels.textPath=t)}pointAttribs(t,e){if(t&&t.isNode){let{...t}=T().prototype.pointAttribs.apply(this,arguments);return t}return super.pointAttribs.apply(this,arguments)}markerAttribs(t){return t.isNode?super.markerAttribs.apply(this,arguments):{}}}$.defaultOptions=V(q.defaultOptions,{centeredLinks:!1,equalNodes:!1,dataLabels:{linkTextPath:{attributes:{startOffset:"25%"}}},marker:{fillOpacity:1,lineWidth:0,states:{},symbol:"circle"},offset:"100%",reversed:!1}),I($.prototype,{orderNodes:!1}),$.prototype.pointClass=x,r().registerSeriesType("arcdiagram",$);let Z=n();export{Z as default};