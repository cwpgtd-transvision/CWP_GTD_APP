import*as t from"../highcharts.js";import"./sankey.js";var e,a={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},d:(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};let s=t.default;var r=a.n(s);a.d({},{});let n=t.default.SeriesRegistry;var o=a.n(n);let{prototype:{pointClass:i}}=o().seriesTypes["sankey"],{pInt:l,wrap:h}=r(),d=class extends i{getDataLabelPath(t){let e=this,a=e.series.chart.renderer,r=e.shapeArgs,n=e.angle<0||e.angle>Math.PI,s=r.start||0,i=r.end||0;return e.dataLabelPath?(e.dataLabelPath=e.dataLabelPath.destroy(),delete e.dataLabelPath):h(t,"destroy",function(t){return e.dataLabelPath&&(e.dataLabelPath=e.dataLabelPath.destroy()),t.call(this)}),e.dataLabelPath=a.arc({open:!0,longArc:Math.abs(Math.abs(s)-Math.abs(i))<Math.PI?0:1}).attr({x:r.x,y:r.y,r:(r.r||0)+l(t.options?.distance||0),start:n?s:i,end:n?i:s,clockwise:+n}).add(a.defs),e.dataLabelPath}isValid(){return!0}},{defined:p,getAlignFactor:c,relativeLength:u}=r();var f=e=e||{};f.compose=function(t,e){return t.sankeyColumn=new g(t,e),t};class g{constructor(t,e){this.points=t,this.series=e}getTranslationFactor(t){let e=this.points,a=e.slice(),r=t.chart,n=t.options.minLinkWidth||0,s,i=0,o,h=(r.plotSizeY||0)-(t.options.borderWidth||0)-(e.length-1)*t.nodePadding;for(;e.length;){for(i=h/e.sankeyColumn.sum(),s=!1,o=e.length;o--;)e[o].getSum()*i<n&&(e.splice(o,1),h=Math.max(0,h-n),s=!0);if(!s)break}for(var d of(e.length=0,a))e.push(d);return i}top(a){let r=this.series,n=r.nodePadding,t=this.points.reduce((t,e)=>(0<t&&(t+=n),t+=Math.max(e.getSum()*a,r.options.minLinkWidth||0)),0);return c(r.options.nodeAlignment||"center")*((r.chart.plotSizeY||0)-t)}left(a){let r=this.series,t=r.chart,n=r.options.equalNodes,s=t.inverted?t.plotHeight:t.plotWidth,i=r.nodePadding,e=this.points.reduce((t,e)=>(0<t&&(t+=i),t+=n?s/e.series.nodes.length-i:Math.max(e.getSum()*a,r.options.minLinkWidth||0)),0);return((t.plotSizeX||0)-Math.round(e))/2}sum(){return this.points.reduce((t,e)=>t+e.getSum(),0)}offset(e,a){let r=this.points,n=this.series,s=n.nodePadding,i=0,o;if(n.is("organization")&&e.hangsFrom)return{absoluteTop:e.hangsFrom.nodeY};for(let t=0;t<r.length;t++){var h=r[t].getSum(),d=Math.max(h*a,n.options.minLinkWidth||0),l=e.options[n.chart.inverted?"offsetHorizontal":"offsetVertical"],c=e.options.offset||0;if(o=h?d+s:0,r[t]===e)return{relativeTop:i+(p(l)?u(l,d):u(c,o))};i+=o}}}f.SankeyColumnAdditions=g;let y=e,m=t.default.SVGElement;var x=a.n(m);let b=r()["deg2rad"],{addEvent:P,merge:M,uniqueKey:k,defined:L,extend:T}=r();function v(n,t){t=M(!0,{enabled:!0,attributes:{dy:-5,startOffset:"50%",textAnchor:"middle"}},t);let s=this.renderer.url,i=this.text||this,e=i.textPath,{attributes:o,enabled:h}=t;return n=n||e&&e.path,e&&e.undo(),n&&h?(t=P(i,"afterModifyTree",a=>{if(n&&h){let t=n.attr("id"),e=(t||n.attr("id",t=k()),{x:0,y:0});L(o.dx)&&(e.dx=o.dx,delete o.dx),L(o.dy)&&(e.dy=o.dy,delete o.dy),i.attr(e),this.attr({transform:""}),this.box&&(this.box=this.box.destroy());var r=a.nodes.slice(0);a.nodes.length=0,a.nodes[0]={tagName:"textPath",attributes:T(o,{"text-anchor":o.textAnchor,href:s+"#"+t}),children:r}}}),i.textPath={path:n,undo:t}):(i.attr({dx:0,dy:0}),delete i.textPath),this.added&&(i.textCache="",this.renderer.buildText(i)),this}function C(d){let a=d.bBox,l=this.element?.querySelector("textPath");if(l){let r=[],{b:n,h:t}=this.renderer.fontMetrics(this.element),s=t-n,e=RegExp('(<tspan>|<tspan(?!\\sclass="highcharts-br")[^>]*>|<\\/tspan>)',"g"),i=l.innerHTML.replace(e,"").split(/<tspan class="highcharts-br"[^>]*>/),o=i.length,h=(t,e)=>{var{x:e,y:a}=e,t=(l.getRotationOfChar(t)-90)*b,r=Math.cos(t),t=Math.sin(t);return[[e-s*r,a-s*t],[e+n*r,a+n*t]]};for(let e=0,a=0;a<o;a++){var p=i[a].length;for(let t=0;t<p;t+=5)try{var c=e+t+a,[u,g]=h(c,l.getStartPositionOfChar(c));0===t?(r.push(g),r.push(u)):(0===a&&r.unshift(g),a===o-1&&r.push(u))}catch(d){break}e+=p-1;try{var f=e+a,y=l.getEndPositionOfChar(f),[x,m]=h(f,y);r.unshift(m),r.unshift(x)}catch(d){break}}r.length&&r.push(r[0].slice()),a.polygon=r}return a}function S(t){let e=t.labelOptions,a=t.point,r=e[a.formatPrefix+"TextPath"]||e.textPath;r&&!e.useHTML&&(this.setTextPath(a.getDataLabelPath?.(this)||a.graphic,r),a.dataLabelPath&&!r.enabled&&(a.dataLabelPath=a.dataLabelPath.destroy()))}let A=r()["animObject"],N=r()["deg2rad"],{pie:O,sankey:w}=o().seriesTypes,{extend:F,merge:W,relativeLength:Y}=r();!function(t){P(t,"afterGetBBox",C),P(t,"beforeAddingDataLabel",S);let e=t.prototype;e.setTextPath||(e.setTextPath=v)}(x());class B extends w{animate(t){if(!t){let a=A(this.options.animation).duration/2/this.nodes.length,r=0;for(let e of this.nodes){let t=e.graphic;t&&(t.attr({opacity:0}),setTimeout(()=>{e.graphic&&e.graphic.animate({opacity:1},{duration:a})},a*r++))}for(var e of this.points){let t=e.graphic;!e.isNode&&t&&t.attr({opacity:0}).animate({opacity:1},this.options.animation)}}}createNode(t){let i=super.createNode(t);return i.getSum=()=>i.linksFrom.concat(i.linksTo).reduce((t,e)=>t+e.weight,0),i.offset=e=>{let a=t=>t.fromNode===i?t.toNode:t.fromNode,r=0,n=i.linksFrom.concat(i.linksTo),s;n.sort((t,e)=>a(t).index-a(e).index);for(let t=0;t<n.length;t++)if(a(n[t]).index>i.index){n=n.slice(0,t).reverse().concat(n.slice(t).reverse()),s=!0;break}s||n.reverse();for(let t=0;t<n.length;t++){if(n[t]===e)return r;r+=n[t].weight}},i}createNodeColumns(){let t=[y.compose([],this)];for(var e of this.nodes)e.column=0,t[0].push(e);return t}getNodePadding(){return this.options.nodePadding/Math.PI}translate(){let l=this.options,p=2*Math.PI/(this.chart.plotHeight+this.getNodePadding()),n=this.getCenter(),c=(l.startAngle-90)*N,t=l.borderRadius,s="object"==typeof t?t.radius:t;for(var u of(super.translate(),this.nodeColumns[0]))if(u.sum){let t=u.shapeArgs,o=n[0],h=n[1],e=n[2]/2,d=e-Y(("auto"===l.nodeWidth?20:l.nodeWidth)||0,e),a=c+p*(t.y||0),r=c+p*((t.y||0)+(t.height||0));for(let i of(u.angle=a+(r-a)/2,u.shapeType="arc",u.shapeArgs={x:o,y:h,r:e,innerR:d,start:a,end:r,borderRadius:s},u.dlBox={x:o+Math.cos((a+r)/2)*(e+d)/2,y:h+Math.sin((a+r)/2)*(e+d)/2,width:1,height:1},u.linksFrom))if(i.linkBase){let n,s,t=i.linkBase.map((t,e)=>{var t=p*t,a=Math.cos(c+t)*(1+d),r=Math.sin(c+t)*(1+d);return n=l.curveFactor||0,(s=Math.abs(i.linkBase[3-e]*p-t))>Math.PI&&(s=2*Math.PI-s),(s*=d)<d&&(n*=s/d),{x:o+a,y:h+r,cpX:o+(1-n)*a,cpY:h+(1-n)*r}});i.shapeArgs={d:[["M",t[0].x,t[0].y],["A",d,d,0,0,1,t[1].x,t[1].y],["C",t[1].cpX,t[1].cpY,t[2].cpX,t[2].cpY,t[2].x,t[2].y],["A",d,d,0,0,1,t[3].x,t[3].y],["C",t[3].cpX,t[3].cpY,t[0].cpX,t[0].cpY,t[0].x,t[0].y]]}}}}}B.defaultOptions=W(w.defaultOptions,{center:[null,null],curveFactor:.6,startAngle:0,dataLabels:{textPath:{enabled:!1,attributes:{dy:5}}}}),F(B.prototype,{orderNodes:!1,getCenter:O.prototype.getCenter}),B.prototype.pointClass=d,o().registerSeriesType("dependencywheel",B);let I=r();export{I as default};