import*as t from"../highcharts.js";import"./map.js";var e,i={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},d:(t,e)=>{for(var a in e)i.o(e,a)&&!i.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};let s=t.default;var a=i.n(s);i.d({},{});let o=t.default.SeriesRegistry;var n=i.n(o);let l=t.default.Color,r=i.n(l)()["parse"],{addEvent:h,extend:p,merge:d,pick:c,splat:u}=a(),x=(!function(t){let l;function x(){let t=this["userOptions"];this.colorAxis=[],t.colorAxis&&(t.colorAxis=u(t.colorAxis),t.colorAxis.map(t=>new l(this,t)))}function g(e){let t=this.chart.colorAxis||[],i=t=>{t=e.allItems.indexOf(t);-1!==t&&(this.destroyItem(e.allItems[t]),e.allItems.splice(t,1))},a=[],s,o;for(t.forEach(function(t){(s=t.options)?.showInLegend&&(s.dataClasses&&s.visible?a=a.concat(t.getDataClassLegendSymbols()):s.visible&&a.push(t),t.series.forEach(function(t){t.options.showInLegend&&!s.dataClasses||("point"===t.options.legendType?t.points.forEach(function(t){i(t)}):i(t))}))}),o=a.length;o--;)e.allItems.unshift(a[o])}function f(t){t.visible&&t.item.legendColor&&t.item.legendItem.symbol.attr({fill:t.item.legendColor})}function y(e){this.chart.colorAxis?.forEach(t=>{t.update({},e.redraw)})}function M(){(this.chart.colorAxis?.length||this.colorAttribs)&&this.translateColors()}function m(){let t=this.axisTypes;t?-1===t.indexOf("colorAxis")&&t.push("colorAxis"):this.axisTypes=["colorAxis"]}function b(t){let e=this,i=t?"show":"hide";e.visible=e.options.visible=!!t,["graphic","dataLabel"].forEach(function(t){e[t]&&e[t][i]()}),this.series.buildKDTree()}function A(){let i=this,t=this.getPointsCollection(),a=this.options.nullColor,s=this.colorAxis,o=this.colorKey;t.forEach(t=>{var e=t.getNestedProperty(o),e=t.options.color||(t.isNull||null===t.value?a:s&&void 0!==e?s.toColor(e,t):t.color||i.color);e&&t.color!==e&&(t.color=e,"point"===i.options.legendType&&t.legendItem&&t.legendItem.label&&i.chart.legend.colorizeItem(t,t.visible))})}function P(){this.elem.attr("fill",r(this.start).tweenTo(r(this.end),this.pos),void 0,!0)}function v(){this.elem.attr("stroke",r(this.start).tweenTo(r(this.end),this.pos),void 0,!0)}t.compose=function(t,e,i,a,s){let o=e.prototype,n=i.prototype,r=s.prototype;if(!o.collectionsWithUpdate.includes("colorAxis")){l=t,o.collectionsWithUpdate.push("colorAxis"),o.collectionsWithInit.colorAxis=[o.addColorAxis],h(e,"afterCreateAxes",x);{i=e;let a=i.prototype.createAxis;i.prototype.createAxis=function(t,e){if("colorAxis"!==t)return a.apply(this,arguments);var i=new l(this,d(e.axis,{index:this[t].length,isX:!1}));return this.isDirtyLegend=!0,this.axes.forEach(t=>{t.series=[]}),this.series.forEach(t=>{t.bindAxes(),t.isDirtyData=!0}),c(e.redraw,!0)&&this.redraw(e.animation),i}}n.fillSetter=P,n.strokeSetter=v,h(a,"afterGetAllItems",g),h(a,"afterColorizeItem",f),h(a,"afterUpdate",y),p(r,{optionalAxis:"colorAxis",translateColors:A}),p(r.pointClass.prototype,{setVisible:b}),h(s,"afterTranslate",M,{order:1}),h(s,"bindAxes",m)}},t.pointSetVisible=b}(e=e||{}),e),{series:{prototype:{pointClass:g}},seriesTypes:{heatmap:{prototype:{pointClass:f}}}}=n(),y=a()["extend"];class m extends f{haloPath(){return this.series.tileShape.haloPath.apply(this,arguments)}}y(m.prototype,{setState:g.prototype.setState,setVisible:x.pointSetVisible});let b=a()["noop"],{heatmap:A,scatter:P}=n().seriesTypes,{clamp:M,pick:L}=a();function v(t,e,i){t=t.options;return{xPad:-(t.colsize||1)/e,yPad:-(t.rowsize||1)/i}}let S={hexagon:{alignDataLabel:P.prototype.alignDataLabel,getSeriesPadding:function(t){return v(t,3,2)},haloPath:function(t){if(!t)return[];var e=this.tileEdges;return[["M",e.x2-t,e.y1+t],["L",e.x3+t,e.y1+t],["L",e.x4+1.5*t,e.y2],["L",e.x3+t,e.y3-t],["L",e.x2-t,e.y3-t],["L",e.x1-1.5*t,e.y2],["Z"]]},translate:function(){let c,t=this.options,u=this.xAxis,x=this.yAxis,g=t.pointPadding||0,f=(t.colsize||1)/3,y=(t.rowsize||1)/2;for(var m of(this.generatePoints(),this.points)){let t=M(Math.floor(u.len-u.translate(m.x-2*f,0,1,0,1)),-u.len,2*u.len),e=M(Math.floor(u.len-u.translate(m.x-f,0,1,0,1)),-u.len,2*u.len),i=M(Math.floor(u.len-u.translate(m.x+f,0,1,0,1)),-u.len,2*u.len),a=M(Math.floor(u.len-u.translate(m.x+2*f,0,1,0,1)),-u.len,2*u.len),s=M(Math.floor(x.translate(m.y-y,0,1,0,1)),-x.len,2*x.len),o=M(Math.floor(x.translate(m.y,0,1,0,1)),-x.len,2*x.len),n=M(Math.floor(x.translate(m.y+y,0,1,0,1)),-x.len,2*x.len),r=m.pointPadding??g,l=r*Math.abs(e-t)/Math.abs(n-o),h=u.reversed?-l:l,p=u.reversed?-r:r,d=x.reversed?-r:r;m.x%2&&(c=c||Math.round(Math.abs(n-s)/2)*(x.reversed?-1:1),s+=c,o+=c,n+=c),m.plotX=m.clientX=(e+i)/2,m.plotY=o,m.tileEdges={x1:t+=h+p,x2:e+=p,x3:i-=p,x4:a-=h+p,y1:s-=d,y2:o,y3:n+=d},m.shapeType="path",m.shapeArgs={d:[["M",e,s],["L",i,s],["L",a,o],["L",i,n],["L",e,n],["L",t,o],["Z"]]}}this.translateColors()}},diamond:{alignDataLabel:P.prototype.alignDataLabel,getSeriesPadding:function(t){return v(t,2,2)},haloPath:function(t){if(!t)return[];var e=this.tileEdges;return[["M",e.x2,e.y1+t],["L",e.x3+t,e.y2],["L",e.x2,e.y3-t],["L",e.x1-t,e.y2],["Z"]]},translate:function(){let p,t=this.options,d=this.xAxis,c=this.yAxis,u=t.pointPadding||0,x=t.colsize||1,g=(t.rowsize||1)/2;for(var f of(this.generatePoints(),this.points)){let t=M(Math.round(d.len-d.translate(f.x-x,0,1,0,0)),-d.len,2*d.len),e=M(Math.round(d.len-d.translate(f.x+x,0,1,0,0)),-d.len,2*d.len),i=M(Math.round(c.translate(f.y-g,0,1,0,0)),-c.len,2*c.len),a=M(Math.round(c.translate(f.y,0,1,0,0)),-c.len,2*c.len),s=M(Math.round(c.translate(f.y+g,0,1,0,0)),-c.len,2*c.len),o=M(Math.round(d.len-d.translate(f.x,0,1,0,0)),-d.len,2*d.len),n=L(f.pointPadding,u),r=n*Math.abs(o-t)/Math.abs(s-a),l=d.reversed?-r:r,h=c.reversed?-n:n;f.x%2&&(p=Math.abs(s-i)/2*(c.reversed?-1:1),i+=p,a+=p,s+=p),f.plotX=f.clientX=o,f.plotY=a,f.tileEdges={x1:t+=l,x2:o,x3:e-=l,y1:i-=h,y2:a,y3:s+=h},f.shapeType="path",f.shapeArgs={d:[["M",o,i],["L",e,a],["L",o,s],["L",t,a],["Z"]]}}this.translateColors()}},circle:{alignDataLabel:P.prototype.alignDataLabel,getSeriesPadding:function(t){return v(t,2,2)},haloPath:function(t){return P.prototype.pointClass.prototype.haloPath.call(this,t+(t&&this.radius))},translate:function(){let t=this.options,s=this.xAxis,o=this.yAxis,n=t.pointPadding||0,r=(t.rowsize||1)/2,l=t.colsize||1,h,p,d,c,u=!1;for(var x of(this.generatePoints(),this.points)){let t=M(Math.round(s.len-s.translate(x.x,0,1,0,0)),-s.len,2*s.len),e=n,i=!1,a=M(Math.round(o.translate(x.y,0,1,0,0)),-o.len,2*o.len);void 0!==x.pointPadding&&(e=x.pointPadding,i=!0,u=!0),c&&!u||(d=Math.floor(Math.sqrt((h=Math.abs(M(Math.floor(s.len-s.translate(x.x+l,0,1,0,0)),-s.len,2*s.len)-t))*h+(p=Math.abs(M(Math.floor(o.translate(x.y+r,0,1,0,0)),-o.len,2*o.len)-a))*p)/2),c=Math.min(h,d,p)-e,u&&!i&&(u=!1)),x.x%2&&(a+=p*(o.reversed?-1:1)),x.plotX=x.clientX=t,x.plotY=a,x.radius=c,x.shapeType="circle",x.shapeArgs={x:t,y:a,r:c}}this.translateColors()}},square:{alignDataLabel:A.prototype.alignDataLabel,translate:A.prototype.translate,getSeriesPadding:b,haloPath:A.prototype.pointClass.prototype.haloPath}},{composed:C,noop:T}=a(),{column:w,heatmap:D,scatter:I}=n().seriesTypes,{addEvent:E,extend:z,merge:O,pushUnique:X}=a();function F(){if(!this.recomputingForTilemap&&"colorAxis"!==this.coll){let e=this,t=e.series.map(function(t){return t.getSeriesPixelPadding&&t.getSeriesPixelPadding(e)}).reduce(function(t,e){return(t&&t.padding)>(e&&e.padding)?t:e},void 0)||{padding:0,axisLengthFactor:1},i=Math.round(t.padding*t.axisLengthFactor);t.padding&&(e.len-=i,e.recomputingForTilemap=!0,e.setAxisTranslation(),delete e.recomputingForTilemap,e.minPixelPadding+=t.padding,e.len+=i)}}class k extends D{static compose(t){X(C,"TilemapSeries")&&E(t,"afterSetAxisTranslation",F)}alignDataLabel(){return this.tileShape.alignDataLabel.apply(this,arguments)}drawPoints(){for(var t of(w.prototype.drawPoints.call(this),this.points))t.graphic&&t.graphic[this.chart.styledMode?"css":"animate"](this.colorAttribs(t))}getSeriesPixelPadding(t){var e=t.isXAxis,i=this.tileShape.getSeriesPadding(this);if(!i)return{padding:0,axisLengthFactor:1};var a=Math.round(t.translate(e?2*i.xPad:i.yPad,0,1,0,1)),i=Math.round(t.translate(e?i.xPad:0,0,1,0,1));return{padding:(t.single?Math.abs(a-i)/2:Math.abs(a-i))||0,axisLengthFactor:e?2:1.1}}setOptions(){var t=super.setOptions.apply(this,arguments);return this.tileShape=S[t.tileShape],t}translate(){return this.tileShape.translate.apply(this,arguments)}}k.defaultOptions=O(D.defaultOptions,{marker:null,states:{hover:{halo:{enabled:!0,size:2,opacity:.5,attributes:{zIndex:3}}}},pointPadding:2,tileShape:"hexagon"}),z(k.prototype,{getSymbol:T,markerAttribs:I.prototype.markerAttribs,pointAttribs:w.prototype.pointAttribs,pointClass:m}),n().registerSeriesType("tilemap",k);let j=a(),V=(k.compose(j.Axis),a());export{V as default};