"use strict";import D from"./Defaults.js";const{defaultOptions,defaultTime}=D;import G from"./Globals.js";const pageLang=G["pageLang"];import U from"./Utilities.js";const{extend,getNestedProperty,isArray,isNumber,isObject,isString,pick,ucfirst}=U,helpers={add:(t,e)=>t+e,divide:(t,e)=>0!==e?t/e:"",eq:(t,e)=>t==e,each:function(n){const r=arguments[arguments.length-1];return!!isArray(n)&&n.map((t,e)=>format(r.body,extend(isObject(t)?t:{"@this":t},{"@index":e,"@first":0===e,"@last":e===n.length-1}))).join("")},ge:(t,e)=>e<=t,gt:(t,e)=>e<t,if:t=>!!t,le:(t,e)=>t<=e,lt:(t,e)=>t<e,multiply:(t,e)=>t*e,ne:(t,e)=>t!=e,subtract:(t,e)=>t-e,ucfirst:ucfirst,unless:t=>!t},numberFormatCache={},isQuotedString=t=>/^["'].+["']$/.test(t);function dateFormat(t,e,n){return defaultTime.dateFormat(t,e,n)}function format(d="",g,h){const t=/\{([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'â€™= #\(\)]+)\}/g,b=/\(([a-zA-Z\u00C0-\u017F\d:\.,;\-\/<>\[\]%_@+"'= ]+)\)/g,e=[],F=/f$/,x=/\.(\d)/,y=h?.options?.lang||defaultOptions.lang,k=h?.time||defaultTime,S=h?.numberFormatter||numberFormat.bind(h),B=(t="")=>{let e;return"true"===t||"false"!==t&&((e=Number(t)).toString()===t?e:isQuotedString(t)?t.slice(1,-1):getNestedProperty(t,g))};let n,r,i=0,s;for(;null!==(n=t.exec(d));){const l=n,m=b.exec(n[1]);m&&(n=m,s=!0);var o,a=((r=r?.isBlock?r:{ctx:g,expression:n[1],find:n[0],isBlock:"#"===n[1].charAt(0),start:n.index,startInner:n.index+n[0].length,length:n[0].length}).isBlock?l:n)[1].split(" ")[0].replace("#",""),a=(helpers[a]&&(r.isBlock&&a===r.fn&&i++,r.fn||(r.fn=a)),"else"===n[1]);if(r.isBlock&&r.fn&&(n[1]==="/"+r.fn||a)?i?a||i--:(o=r.startInner,o=d.substr(o,n.index-o),void 0===r.body?(r.body=o,r.startInner=n.index+n[0].length):r.elseBody=o,r.find+=o+n[0],a||(e.push(r),r=void 0)):r.isBlock||e.push(r),m&&!r?.isBlock)break}return e.forEach(n=>{const{body:r,elseBody:i,expression:s,fn:o}=n;let a,l;if(o){const u=[n],c=[],f=s.length;let t=0,e;for(l=0;l<=f;l++){var m=s.charAt(l);e||'"'!==m&&"'"!==m?e===m&&(e=""):e=m,e||" "!==m&&l!==f||(c.push(s.substr(t,l-t)),t=l+1)}for(l=helpers[o].length;l--;)u.unshift(B(c[l+1]));a=helpers[o].apply(g,u),n.isBlock&&"boolean"==typeof a&&(a=format(a?r:i,g,h))}else{const e=isQuotedString(s)?[s]:s.split(":");var t=(a=B(e.shift()||""))%1!=0;if("number"==typeof a&&(e.length||t)){const p=e.join(":");F.test(p)||t?(t=parseInt((p.match(x)||["","-1"])[1],10),null!==a&&(a=S(a,t,y.decimalPoint,-1<p.indexOf(",")?y.thousandsSep:""))):a=k.dateFormat(p,a)}b.lastIndex=0,b.test(n.find)&&isString(a)&&(a=`"${a}"`)}d=d.replace(n.find,pick(a,""))}),s?format(d,g,h):d}function numberFormat(t,e,n,r){e=+e;let i,s,[o,a]=(t=+t||0).toString().split("e").map(Number);const l=this?.options?.lang||defaultOptions.lang,m=(t.toString().split(".")[1]||"").split("e")[0].length,u=e,c={},f=(n=n??l.decimalPoint,r=r??l.thousandsSep,-1===e?e=Math.min(m,20):isNumber(e)?e&&a<0&&(0<=(s=e+a)?(o=+o.toExponential(s).split("e")[0],e=s):(o=Math.floor(o),t=e<20?+(o*Math.pow(10,a)).toFixed(e):0,a=0)):e=2,a&&(e=e??2,t=o),isNumber(e)&&0<=e&&(c.minimumFractionDigits=e,c.maximumFractionDigits=e),""===r&&(c.useGrouping=!1),r||n),p=f?"en":this?.locale||l.locale||pageLang,d=JSON.stringify(c)+p,g=numberFormatCache[d]??(numberFormatCache[d]=new Intl.NumberFormat(p,c));return i=g.format(t),f&&(i=i.replace(/([,\.])/g,"_$1").replace(/_\,/g,r??",").replace("_.",n??".")),(!e&&0==+i||a<0&&!u)&&(i="0"),a&&0!=+i&&(i+="e"+(a<0?"":"+")+a),i}const Templating={dateFormat:dateFormat,format:format,helpers:helpers,numberFormat:numberFormat};export default Templating;