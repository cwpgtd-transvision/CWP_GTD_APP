"use strict";import A from"../Animation/AnimationUtilities.js";const getDeferredAnimation=A["getDeferredAnimation"];import F from"../Templating.js";const format=F["format"];import U from"../Utilities.js";const{defined,extend,fireEvent,getAlignFactor,isArray,isString,merge,objectEach,pick,pInt,splat}=U;var DataLabel;!function(){function e(){return d(this).some(t=>t?.enabled)}function a(t,i,e,a,o){const r=this,{chart:s,enabledDataSorting:n}=this,l=this.isCartesian&&s.inverted,d=t.plotX,h=t.plotY,c=e.rotation||0,g=defined(d)&&defined(h)&&s.isInsidePlot(d,Math.round(h),{inverted:l,paneCoordinates:!0,series:r}),p=0===c&&"justify"===pick(e.overflow,n?"none":"justify");let f=this.visible&&!1!==t.visible&&defined(d)&&(t.series.forceDL||n&&!p||g||pick(e.inside,!!this.options.stacking)&&a&&s.isInsidePlot(d,l?a.x+1:a.y+a.height-1,{inverted:l,paneCoordinates:!0,series:r}));var b,u,y,v=t.pos();f&&v&&(b=i.getBBox(),u=i.getBBox(void 0,0),a=extend({x:v[0],y:Math.round(v[1]),width:0,height:0},a||{}),"plotEdges"===e.alignTo&&r.isCartesian&&(a[l?"x":"y"]=0,a[l?"width":"height"]=this.yAxis?.len||0),extend(e,{width:b.width,height:b.height}),y=a,n&&r.xAxis&&!p&&r.setDataLabelStartPos(t,i,o,g,y),i.align(merge(e,{width:u.width,height:u.height}),!1,a,!1),i.alignAttr.x+=getAlignFactor(e.align)*(u.width-b.width),i.alignAttr.y+=getAlignFactor(e.verticalAlign)*(u.height-b.height),i[i.placed?"animate":"attr"]({"text-align":i.alignAttr["text-align"]||"center",x:i.alignAttr.x+(b.width-u.width)/2,y:i.alignAttr.y+(b.height-u.height)/2,rotationOriginX:(i.width||0)/2,rotationOriginY:(i.height||0)/2}),p&&0<=a.height?this.justifyDataLabel(i,e,i.alignAttr,b,a,o):pick(e.crop,!0)&&({x:t,y}=i.alignAttr,f=s.isInsidePlot(t,y,{paneCoordinates:!0,series:r})&&s.isInsidePlot(t+b.width-1,y+b.height-1,{paneCoordinates:!0,series:r})),e.shape&&!c&&i[o?"attr":"animate"]({anchorX:v[0],anchorY:v[1]})),o&&n&&(i.placed=!1),f||n&&!p?(i.show(),i.placed=!0):(i.hide(),i.placed=!1)}function o(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6,this.chart.dataLabelsGroup)}function r(t){var i=this,e=i.hasRendered||0;const a=this.initDataLabelsGroup().attr({opacity:+e});return!e&&a&&(i.visible&&a.show(),i.options.animation?a.animate({opacity:1},t):a.attr({opacity:1})),a}function s(t){t=t||this.points;const m=this,A=m.chart,L=m.options,w=A.renderer,{backgroundColor:i,plotBackgroundColor:e}=A.options.chart,D=w.getContrast(isString(e)&&e||isString(i)&&i||"#000000"),a=d(m);let o,C;var{animation:r,defer:s}=a[0],s=s?getDeferredAnimation(A,r,m):{defer:0,duration:0};fireEvent(this,"drawDataLabels"),m.hasDataLabels?.()&&(C=this.initDataLabels(s),t.forEach(y=>{const v=y.dataLabels||[],x=y.color||m.color;(o=splat(l(a,y.dlOptions||y.options?.dataLabels))).forEach((t,i)=>{const e=t.enabled&&(y.visible||y.dataLabelOnHidden)&&(!y.isNull||y.dataLabelOnNull)&&(n=y,!(l=(l=t).filter)||(d=l.operator,n=n[l.property],l=l.value,">"===d&&l<n||"<"===d&&n<l||">="===d&&l<=n||"<="===d&&n<=l||"=="===d&&n==l||"==="===d&&n===l||"!="===d&&n!=l||"!=="===d&&n!==l)),{backgroundColor:a,borderColor:o,distance:r,style:s={}}=t;var n,l,d;let h,c,g,p={},f=v[i],b=!f,u;e&&(h=pick(t[y.formatPrefix+"Format"],t.format),c=defined(h)?format(h,y,A):(t[y.formatPrefix+"Formatter"]||t.formatter).call(y,t),g=t.rotation,A.styledMode||(s.color=pick(t.color,s.color,isString(m.color)?m.color:void 0,"#000000"),"contrast"===s.color?("none"!==a&&(u=a),y.contrastColor=w.getContrast("auto"!==u&&isString(u)&&u||(isString(x)?x:"")),s.color=u||!defined(r)&&t.inside||pInt(r||0)<0||L.stacking?y.contrastColor:D):delete y.contrastColor,L.cursor&&(s.cursor=L.cursor)),p={r:t.borderRadius||0,rotation:g,padding:t.padding,zIndex:1},A.styledMode||(p.fill="auto"===a?y.color:a,p.stroke="auto"===o?y.color:o,p["stroke-width"]=t.borderWidth),objectEach(p,(t,i)=>{void 0===t&&delete p[i]})),!f||e&&defined(c)&&!(!f.div&&!f.text?.foreignObject)==!!t.useHTML&&(f.rotation&&t.rotation||f.rotation===t.rotation)||(f=void 0,b=!0),e&&defined(c)&&""!==c&&(f?p.text=c:(f=w.label(c,0,0,t.shape,void 0,void 0,t.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+y.colorIndex+" "+(t.className||"")+(t.useHTML?" highcharts-tracker":"")),f&&(f.options=t,f.attr(p),A.styledMode?s.width&&f.css({width:s.width,textOverflow:s.textOverflow,whiteSpace:s.whiteSpace}):f.css(s).shadow(t.shadow),fireEvent(f,"beforeAddingDataLabel",{labelOptions:t,point:y}),f.added||f.add(C),m.alignDataLabel(y,f,t,void 0,b),f.isActive=!0,v[i]&&v[i]!==f&&v[i].destroy(),v[i]=f))});let t=v.length;for(;t--;)v[t]?.isActive?v[t].isActive=!1:(v[t]?.destroy(),v.splice(t,1));y.dataLabel=v[0],y.dataLabels=v})),fireEvent(this,"afterDrawDataLabels")}function n(t,i,e,a,o,r){var s=this.chart,n=i.align,l=i.verticalAlign,d=!t.box&&t.padding||0,h=s.inverted?this.yAxis:this.xAxis,h=h?h.left-s.plotLeft:0,c=s.inverted?this.xAxis:this.yAxis,c=c?c.top-s.plotTop:0;let{x:g=0,y:p=0}=i,f,b;return(f=(e.x||0)+d+h)<0&&("right"===n&&0<=g?(i.align="left",i.inside=!0):g-=f,b=!0),(f=(e.x||0)+a.width-d+h)>s.plotWidth&&("left"===n&&g<=0?(i.align="right",i.inside=!0):g+=s.plotWidth-f,b=!0),(f=e.y+d+c)<0&&("bottom"===l&&0<=p?(i.verticalAlign="top",i.inside=!0):p-=f,b=!0),(f=(e.y||0)+a.height-d+c)>s.plotHeight&&("top"===l&&p<=0?(i.verticalAlign="bottom",i.inside=!0):p+=s.plotHeight-f,b=!0),b&&(i.x=g,i.y=p,t.placed=!r,t.align(i,void 0,o)),b}function l(i,e){let t=[],a;if(isArray(i)&&!isArray(e))t=i.map(function(t){return merge(t,e)});else if(isArray(e)&&!isArray(i))t=e.map(function(t){return merge(i,t)});else if(isArray(i)||isArray(e)){if(isArray(i)&&isArray(e))for(a=Math.max(i.length,e.length);a--;)t[a]=merge(i[a],e[a])}else t=merge(i,e);return t}function d(t){var i=t.chart.options.plotOptions;return splat(l(l(i?.series?.dataLabels,i?.[t.type]?.dataLabels),t.options.dataLabels))}function h(t,i,e,a,o){var r=this.chart,s=r.inverted,n=this.xAxis,l=n.reversed,d=((s?i.height:i.width)||0)/2,t=t.pointWidth,t=t?t/2:0;i.startXPos=s?o.x:l?-d-t:n.width-d+t,i.startYPos=s?l?this.yAxis.height-d+t:-d-t:o.y,a?"hidden"===i.visibility&&(i.show(),i.attr({opacity:0}).animate({opacity:1})):i.attr({opacity:1}).animate({opacity:0},void 0,i.hide),r.hasRendered&&(e&&i.attr({x:i.startXPos,y:i.startYPos}),i.placed=!0)}(DataLabel||(DataLabel={})).compose=function(t){const i=t.prototype;i.initDataLabels||(i.initDataLabels=r,i.initDataLabelsGroup=o,i.alignDataLabel=a,i.drawDataLabels=s,i.justifyDataLabel=n,i.mergeArrays=l,i.setDataLabelStartPos=h,i.hasDataLabels=e)}}();export default DataLabel;