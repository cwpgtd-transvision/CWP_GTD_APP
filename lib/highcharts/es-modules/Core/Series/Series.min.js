"use strict";import A from"../Animation/AnimationUtilities.js";const{animObject,setAnimation}=A;import DataTableCore from"../../Data/DataTableCore.js";import D from"../Defaults.js";const defaultOptions=D["defaultOptions"];import F from"../Foundation.js";const registerEventOptions=F["registerEventOptions"];import H from"../Globals.js";const{svg,win}=H;import LegendSymbol from"../Legend/LegendSymbol.js";import Point from"./Point.js";import SeriesDefaults from"./SeriesDefaults.js";import SeriesRegistry from"./SeriesRegistry.js";const seriesTypes=SeriesRegistry["seriesTypes"];import SVGElement from"../Renderer/SVG/SVGElement.js";import T from"../Templating.js";const format=T["format"];import U from"../Utilities.js";const{arrayMax,arrayMin,clamp,correctFloat,crisp,defined,destroyObjectProperties,diffObjects,erase,error,extend,find,fireEvent,getClosestDistance,getNestedProperty,insertItem,isArray,isNumber,isString,merge,objectEach,pick,removeEvent,syncTimeout}=U;class Series{constructor(){this.zoneAxis="y"}init(t,e){fireEvent(this,"init",{options:e}),this.dataTable??(this.dataTable=new DataTableCore);var i=this,s=t.series,e=(this.eventsToUnbind=[],i.chart=t,i.options=i.setOptions(e),i.options),r=!1!==e.visible,r=(i.linkedSeries=[],i.bindAxes(),extend(i,{name:e.name,state:"",visible:r,selected:!0===e.selected}),registerEventOptions(this,e),e.events);(r?.click||e.point?.events?.click||e.allowPointSelect)&&(t.runTrackerClick=!0),i.getColor(),i.getSymbol(),i.isCartesian&&(t.hasCartesianSeries=!0);let o;s.length&&(o=s[s.length-1]),i._i=pick(o?._i,-1)+1,i.opacity=i.options.opacity,t.orderItems("series",insertItem(this,s)),e.dataSorting?.enabled?i.setDataSortingOptions():i.points||i.data||i.setData(e.data,!1),fireEvent(this,"afterInit")}is(t){return seriesTypes[t]&&this instanceof seriesTypes[t]}bindAxes(){const i=this,s=i.options,t=i.chart;let r;fireEvent(this,"bindAxes",null,function(){(i.axisTypes||[]).forEach(function(e){(t[e]||[]).forEach(function(t){r=t.options,(pick(s[e],0)===t.index||void 0!==s[e]&&s[e]===r.id)&&(insertItem(i,t.series),(i[e]=t).isDirty=!0)}),i[e]||i.optionalAxis===e||error(18,!0,t)})}),fireEvent(this,"afterBindAxes")}hasData(){return this.visible&&void 0!==this.dataMax&&void 0!==this.dataMin||this.visible&&0<this.dataTable.rowCount}hasMarkerChanged(t,e){t=t.marker,e=e.marker||{};return t&&(e.enabled&&!t.enabled||e.symbol!==t.symbol||e.height!==t.height||e.width!==t.width)}autoIncrement(t){const e=this.options,{pointIntervalUnit:i,relativeXValue:s}=this.options,r=this.chart.time,o=this.xIncrement??r.parse(e.pointStart)??0;let a;if(this.pointInterval=a=pick(this.pointInterval,e.pointInterval,1),s&&isNumber(t)&&(a*=t),i){const n=r.toParts(o);"day"===i?n[2]+=a:"month"===i?n[1]+=a:"year"===i&&(n[0]+=a),a=r.makeTime.apply(r,n)-o}return s&&isNumber(t)?o+a:(this.xIncrement=o+a,o)}setDataSortingOptions(){const t=this.options;extend(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),defined(t.pointRange)||(t.pointRange=1)}setOptions(t){var e=this.chart,i=e.options.plotOptions,s=e.userOptions||{},t=merge(t),r=e.styledMode,o={plotOptions:i,userOptions:t};let a;fireEvent(this,"setOptions",o);const n=o.plotOptions[this.type],l=s.plotOptions||{},h=l.series||{},d=defaultOptions.plotOptions[this.type]||{},p=l[this.type]||{},c=(n.dataLabels=this.mergeArrays(d.dataLabels,n.dataLabels),this.userOptions=o.userOptions,merge(n,i.series,p,t)),u=(this.tooltipOptions=merge(defaultOptions.tooltip,defaultOptions.plotOptions.series?.tooltip,d?.tooltip,e.userOptions.tooltip,l.series?.tooltip,p.tooltip,t.tooltip),this.stickyTracking=pick(t.stickyTracking,p.stickyTracking,h.stickyTracking,!(!this.tooltipOptions.shared||this.noSharedTooltip)||c.stickyTracking),null===n.marker&&delete c.marker,this.zoneAxis=c.zoneAxis||"y",this.zones=(c.zones||[]).map(t=>({...t})));return!c.negativeColor&&!c.negativeFillColor||c.zones||(a={value:c[this.zoneAxis+"Threshold"]||c.threshold||0,className:"highcharts-negative"},r||(a.color=c.negativeColor,a.fillColor=c.negativeFillColor),u.push(a)),u.length&&defined(u[u.length-1].value)&&u.push(r?{}:{color:this.color,fillColor:this.fillColor}),fireEvent(this,"afterSetOptions",{options:c}),c}getName(){return this.options.name??format(this.chart.options.lang.seriesName,this,this.chart)}getCyclic(t,e,i){const s=this.chart,r=t+"Index",o=t+"Counter",a=i?.length||s.options.chart.colorCount;let n,l;e||(l=pick("color"===t?this.options.colorIndex:void 0,this[r]),defined(l)?n=l:(s.series.length||(s[o]=0),n=s[o]%a,s[o]+=1),i&&(e=i[n])),void 0!==n&&(this[r]=n),this[t]=e}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||defaultOptions.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){var t=this.options.marker;this.getCyclic("symbol",t.symbol,this.chart.options.symbols)}getColumn(t,e){return(e?this.dataTable.modified:this.dataTable).getColumn(t,!0)||[]}findPointIndex(e,t){var{id:i,x:s}=e,r=this.points,o=this.options.dataSorting,a=this.cropStart||0;let n,l,h;if(i){i=this.chart.get(i);i instanceof Point&&(n=i)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let t=t=>!t.touched&&t.index===e.index;if(o?.matchByName?t=t=>!t.touched&&t.name===e.name:this.options.relativeXValue&&(t=t=>!t.touched&&t.options.x===e.x),!(n=find(r,t)))return}return n&&void 0!==(h=n?.index)&&(l=!0),-1!==(h=void 0===h&&isNumber(s)?this.getColumn("x").indexOf(s,t):h)&&void 0!==h&&this.cropped&&(h=h>=a?h-a:h),h=!l&&isNumber(h)&&r[h]?.touched?void 0:h}updateData(t,e){const{options:o,requireSorting:a}=this,n=o.dataSorting,l=this.points,h=[],d=t.length===l.length;let p,i,s,c,r=!0;if(this.xIncrement=null,t.forEach((t,e)=>{var i=defined(t)&&this.pointClass.prototype.optionsToObject.call({series:this},t)||{},{id:s,x:r}=i;s||isNumber(r)?(-1===(s=this.findPointIndex(i,c))||void 0===s?h.push(t):l[s]&&t!==o.data?.[s]?(l[s].update(t,!1,void 0,!1),l[s].touched=!0,a&&(c=s+1)):l[s]&&(l[s].touched=!0),d&&e===s&&!n?.enabled&&!this.hasDerivedData||(p=!0)):h.push(t)},this),p)for(i=l.length;i--;)(s=l[i])&&!s.touched&&s.remove?.(!1,e);else d&&!n?.enabled?(t.forEach((t,e)=>{t===l[e].y||l[e].destroyed||l[e].update(t,!1,void 0,!1)}),h.length=0):r=!1;if(l.forEach(t=>{t&&(t.touched=!1)}),!r)return!1;h.forEach(t=>{this.addPoint(t,!1,void 0,void 0,!1)},this);t=this.getColumn("x");return null===this.xIncrement&&t.length&&(this.xIncrement=arrayMax(t),this.autoIncrement()),!0}dataColumnKeys(){return["x",...this.pointArrayMap||["y"]]}setData(e,t=!0,i,s){const r=this,o=r.points,a=o?.length||0,n=r.options,l=r.chart,R=n.dataSorting,h=r.xAxis,d=n.turboThreshold,p=this.dataTable,c=this.dataColumnKeys(),u=r.pointValKey||"y",j=r.pointArrayMap||[],m=j.length,g=n.keys;let f,y,v=0,x=1,b;l.options.chart.allowMutatingData||(n.data&&delete r.options.data,r.userOptions.data&&delete r.userOptions.data,b=merge(!0,e));var k=(e=b||e||[]).length;if(R?.enabled&&(e=this.sortData(e)),!(y=l.options.chart.allowMutatingData&&!1!==s&&k&&a&&!r.cropped&&!r.hasGroupedData&&r.visible&&!r.boosted?this.updateData(e,i):y)){r.xIncrement=null,r.colorCounter=0;let t=d&&!n.relativeXValue&&d<k;if(t){var s=r.getFirstValidPoint(e),C=r.getFirstValidPoint(e,k-1,-1),S=t=>Boolean(isArray(t)&&(g||isNumber(t[0])));if(isNumber(s)&&isNumber(C)){const T=[],D=[];for(const E of e)T.push(this.autoIncrement()),D.push(E);p.setColumns({x:T,[u]:D})}else if(S(s)&&S(C))if(m){const A=s.length===m?1:0,O=new Array(c.length).fill(0).map(()=>[]);for(const P of e){A&&O[0].push(this.autoIncrement());for(let t=A;t<=m;t++)O[t]?.push(P[t-A])}p.setColumns(c.reduce((t,e,i)=>(t[e]=O[i],t),{}))}else{g&&(v=g.indexOf("x"),x=g.indexOf("y"),v=0<=v?v:0,x=0<=x?x:1),1===s.length&&(x=0);const w=[],M=[];if(v===x)for(const I of e)w.push(this.autoIncrement()),M.push(I[x]);else for(const N of e)w.push(N[v]),M.push(N[x]);p.setColumns({x:w,[u]:M})}else t=!1}if(!t){const G=c.reduce((t,e)=>(t[e]=[],t),{});for(f=0;f<k;f++){var L=r.pointClass.prototype.applyOptions.apply({series:r},[e[f]]);for(const X of c)G[X][f]=L[X]}p.setColumns(G)}for(isString(this.getColumn("y")[0])&&error(14,!0,l),r.data=[],r.options.data=r.userOptions.data=e,f=a;f--;)o[f]?.destroy();h&&(h.minRange=h.userMinRange),r.isDirty=l.isDirtyBox=!0,r.isDirtyData=!!o,i=!1}"point"===n.legendType&&(this.processData(),this.generatePoints()),t&&l.redraw(i)}sortData(r){function o(t,e){return defined(e)&&t.pointClass.prototype.optionsToObject.call({series:t},e)||{}}const i=this,t=i.options,e=t.dataSorting,s=e.sortKey||"y",a=(r.forEach(function(t,e){r[e]=o(i,t),r[e].index=e},this),r.concat().sort((t,e)=>{t=getNestedProperty(s,t),e=getNestedProperty(s,e);return e<t?-1:t<e?1:0}));return a.forEach(function(t,e){t.x=e},this),i.linkedSeries&&i.linkedSeries.forEach(function(i){const t=i.options,s=t.data;!t.dataSorting?.enabled&&s&&(s.forEach(function(t,e){s[e]=o(i,t),r[e]&&(s[e].x=r[e].x,s[e].index=e)}),i.setData(s,!1))}),r}getProcessedData(t){const e=this,{dataTable:i,isCartesian:s,options:r,xAxis:o}=e,a=r.cropThreshold,n=t||e.getExtremesFromAll,l=o?.logarithmic,h=i.rowCount;let d,p,c=0,u,m,g,f=e.getColumn("x"),y=i,v=!1;o&&(m=(u=o.getExtremes()).min,g=u.max,v=!(!o.categories||o.names.length),s&&e.sorted&&!n&&(!a||a<h||e.forceCrop)&&(f[h-1]<m||f[0]>g?y=new DataTableCore:e.getColumn(e.pointValKey||"y").length&&(f[0]<m||f[h-1]>g)&&(d=this.cropData(i,m,g),y=d.modified,c=d.start,p=!0))),f=y.getColumn("x")||[];t=getClosestDistance([l?f.map(l.log2lin):f],()=>e.requireSorting&&!v&&error(15,!1,e.chart));return{modified:y,cropped:p,cropStart:c,closestPointRange:t}}processData(t){const e=this,i=e.xAxis,s=e.dataTable;if(e.isCartesian&&!e.isDirty&&!i.isDirty&&!e.yAxis.isDirty&&!t)return!1;t=e.getProcessedData();s.modified=t.modified,e.cropped=t.cropped,e.cropStart=t.cropStart,e.closestPointRange=e.basePointRange=t.closestPointRange,fireEvent(e,"afterProcessData")}cropData(t,e,i){const s=t.getColumn("x",!0)||[],r=s.length,o={};let a,n,l=0,h=r;for(a=0;a<r;a++)if(s[a]>=e){l=Math.max(0,a-1);break}for(n=a;n<r;n++)if(s[n]>i){h=n+1;break}for(const d of this.dataColumnKeys()){const p=t.getColumn(d,!0);p&&(o[d]=p.slice(l,h))}return{modified:new DataTableCore({columns:o}),start:l,end:h}}generatePoints(){const t=this,e=t.options,i=t.processedData||e.data,s=t.dataTable.modified,r=t.getColumn("x",!0),o=t.pointClass,a=s.rowCount,n=t.cropStart||0,l=t.hasGroupedData,h=e.keys,d=[],p=e.dataGrouping?.groupAll?n:0,c=t.xAxis?.categories,u=t.pointArrayMap||["y"],m=this.dataColumnKeys();let g,f,y,v,x=t.data,b;if(!x&&!l){const k=[];k.length=i?.length||0,x=t.data=k}for(h&&l&&(t.options.keys=!1),v=0;v<a;v++)f=n+v,l?((y=new o(t,s.getRow(v,m)||[])).dataGroup=t.groupMap[p+v],y.dataGroup?.options&&(y.options=y.dataGroup.options,extend(y,y.dataGroup.options),delete y.dataLabels)):(y=x[f],b=i?i[f]:s.getRow(v,u),y||void 0===b||(x[f]=y=new o(t,b,r[v]))),y&&(y.index=l?p+v:f,(d[v]=y).category=c?.[y.x]??y.x,y.key=y.name??y.category);if(t.options.keys=h,x&&(a!==(g=x.length)||l))for(v=0;v<g;v++)v!==n||l||(v+=a),x[v]&&(x[v].destroyElements(),x[v].plotX=void 0);t.data=x,t.points=d,fireEvent(this,"afterGeneratePoints")}getXExtremes(t){return{min:arrayMin(t),max:arrayMax(t)}}getExtremes(t,e){const{xAxis:i,yAxis:s}=this,r=e||this.getExtremesFromAll||this.options.getExtremesFromAll,o=r&&this.cropped?this.dataTable:this.dataTable.modified,a=o.rowCount,n=t||this.stackedYData,l=n?[n]:(this.keysAffectYAxis||this.pointArrayMap||["y"])?.map(t=>o.getColumn(t,!0)||[])||[],h=this.getColumn("x",!0),d=[],p=this.requireSorting&&!this.is("column")?1:0,c=!!s&&s.positiveValuesOnly,u=r||this.cropped||!i;let m,g,f,y=0,v=0;for(i&&(m=i.getExtremes(),y=m.min,v=m.max),f=0;f<a;f++)if(g=h[f],u||(h[f+p]||g)>=y&&(h[f-p]||g)<=v)for(const b of l){var x=b[f];isNumber(x)&&(0<x||!c)&&d.push(x)}e={activeYData:d,dataMin:arrayMin(d),dataMax:arrayMax(d)};return fireEvent(this,"afterGetExtremes",{dataExtremes:e}),e}applyExtremes(){var t=this.getExtremes();return this.dataMin=t.dataMin,this.dataMax=t.dataMax,t}getFirstValidPoint(t,e=0,i=1){var s=t.length;let r=e;for(;0<=r&&r<s;){if(defined(t[r]))return t[r];r+=i}}translate(){this.generatePoints();const o=this,t=o.options,a=t.stacking,n=o.xAxis,l=o.enabledDataSorting,h=o.yAxis,d=o.points,e=d.length,p=o.pointPlacementToXValue(),c=Boolean(p),u=t.threshold,m=t.startFromThreshold?u:0,g=t?.nullInteraction&&h.len;let f,y,v,x,b=Number.MAX_VALUE;function k(t){return clamp(t,-1e9,1e9)}for(f=0;f<e;f++){const S=d[f],T=S.x;let t,e,i=S.y,s=S.low;var C=a&&h.stacking?.stacks[(o.negStacks&&i<(m?0:u)?"-":"")+o.stackKey];y=n.translate(T,!1,!1,!1,!0,p),S.plotX=isNumber(y)?correctFloat(k(y)):void 0,a&&o.visible&&C&&C[T]&&(x=o.getStackIndicator(x,T,o.index),!S.isNull&&x.key&&(t=C[T],e=t.points[x.key]),t&&isArray(e)&&(s=e[0],i=e[1],s===m&&x.key===C[T].base&&(s=pick(isNumber(u)?u:h.min)),h.positiveValuesOnly&&defined(s)&&s<=0&&(s=void 0),S.total=S.stackTotal=pick(t.total),S.percentage=defined(S.y)&&t.total?S.y/t.total*100:void 0,S.stackY=i,o.irregularWidths||t.setOffset(o.pointXOffset||0,o.barW||0,void 0,void 0,void 0,o.xAxis))),S.yBottom=defined(s)?k(h.translate(s,!1,!0,!1,!0)):void 0,o.dataModify&&(i=o.dataModify.modifyValue(i,f));let r;isNumber(i)&&void 0!==S.plotX?(r=h.translate(i,!1,!0,!1,!0),r=isNumber(r)?k(r):void 0):!isNumber(i)&&g&&(r=g),S.plotY=r,S.isInside=this.isPointInside(S),S.clientX=c?correctFloat(n.translate(T,!1,!1,!1,!0,p)):y,S.negative=(S.y||0)<(u||0),S.isNull||!1===S.visible||(void 0!==v&&(b=Math.min(b,Math.abs(y-v))),v=y),S.zone=this.zones.length?S.getZone():void 0,!S.graphic&&o.group&&l&&(S.isNew=!0)}o.closestPointRangePx=b,fireEvent(this,"afterTranslate")}getValidPoints(t,s,r){const o=this.chart;return(t||this.points||[]).filter(function(t){var{plotX:e,plotY:i}=t;return!(!(r||!t.isNull&&isNumber(i))||s&&!o.isInsidePlot(e,i,{inverted:o.inverted}))&&!1!==t.visible})}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){const{chart:t,group:e,markerGroup:i}=this,s=t.sharedClips,r=t.renderer,o=t.getClipBox(this),a=this.getSharedClipKey();let n=s[a];n?n.animate(o):s[a]=n=r.clipRect(o),e&&e.clip(!1===this.options.clip?void 0:n),i&&i.clip()}animate(t){const{chart:e,group:i,markerGroup:s}=this,r=e.inverted,o=animObject(this.options.animation),a=[this.getSharedClipKey(),o.duration,o.easing,o.defer].join(",");let n=e.sharedClips[a],l=e.sharedClips[a+"m"];if(t&&i){const h=e.getClipBox(this);n?n.attr("height",h.height):(h.width=0,r&&(h.x=e.plotHeight),n=e.renderer.clipRect(h),e.sharedClips[a]=n,t={x:(r,-99),y:(r,-99),width:r?e.plotWidth+199:99,height:r?99:e.plotHeight+199},l=e.renderer.clipRect(t),e.sharedClips[a+"m"]=l),i.clip(n),s?.clip(l)}else if(n&&!n.hasClass("highcharts-animating")){const d=e.getClipBox(this),p=o.step;(s?.element.childNodes.length||1<e.series.length)&&(o.step=function(t,e){p&&p.apply(e,arguments),"width"===e.prop&&l?.element&&l.attr(r?"height":"width",t+99)}),n.addClass("highcharts-animating").animate(d,o)}}afterAnimate(){this.setClip(),objectEach(this.chart.sharedClips,(t,e,i)=>{t&&!this.chart.container.querySelector(`[clip-path="url(#${t.id})"]`)&&(t.destroy(),delete i[e])}),this.finishedAnimating=!0,fireEvent(this,"afterAnimate")}drawPoints(t=this.points){const e=this,i=e.chart,s=i.styledMode,{colorAxis:r,options:o}=e,a=o.marker,n=o.nullInteraction,l=e[e.specialGroup||"markerGroup"],h=e.xAxis,d=pick(a.enabled,!(h&&!h.isRadial)||null,e.closestPointRangePx>=a.enabledThreshold*a.radius);let p,c,u,m,g,f,y;if(!1!==a.enabled||e._hasPointMarkers)for(p=0;p<t.length;p++){c=t[p],u=c.graphic,m=u?"animate":"attr",g=c.marker||{},f=!!c.marker;var v,x=c.isNull;(d&&!defined(g.enabled)||g.enabled)&&(!x||n)&&!1!==c.visible?(x=pick(g.symbol,e.symbol,"rect"),y=e.markerAttribs(c,c.selected&&"select"),e.enabledDataSorting&&(c.startXPos=h.reversed?-(y.width||0):h.width),v=!1!==c.isInside,!u&&v&&(0<(y.width||0)||c.hasImage)&&(c.graphic=u=i.renderer.symbol(x,y.x,y.y,y.width,y.height,f?g:a).add(l),e.enabledDataSorting&&i.hasRendered&&(u.attr({x:c.startXPos}),m="animate")),u&&"animate"===m&&u[v?"show":"hide"](v).animate(y),u&&(x=e.pointAttribs(c,s||!c.selected?void 0:"select"),s?r&&u.css({fill:x.fill}):u[m](x)),u&&u.addClass(c.getClassName(),!0)):u&&(c.graphic=u.destroy())}}markerAttribs(t,e){const i=this.options,s=i.marker,r=t.marker||{},o=r.symbol||s.symbol,a={};let n,l,h=pick(r.radius,s?.radius);e&&(n=s.states[e],l=r.states&&r.states[e],h=pick(l?.radius,n?.radius,h&&h+(n?.radiusPlus||0))),t.hasImage=o&&0===o.indexOf("url"),t.hasImage&&(h=0);const d=t.pos();return isNumber(h)&&d&&(i.crisp&&(d[0]=crisp(d[0],t.hasImage?0:"rect"===o?s?.lineWidth||0:1)),a.x=d[0]-h,a.y=d[1]-h),h&&(a.width=a.height=2*h),a}pointAttribs(t,e){var i=this.options,s=i.marker,r=t?.options,o=r?.marker||{},r=r?.color,a=t?.color,n=t?.zone?.color;let l,h,d=this.color,p,c,u=pick(o.lineWidth,s.lineWidth),m=t?.isNull&&i.nullInteraction?0:1;return d=r||n||a||d,p=o.fillColor||s.fillColor||d,c=o.lineColor||s.lineColor||d,(e=e||"normal")&&(l=s.states[e]||{},h=o.states&&o.states[e]||{},u=pick(h.lineWidth,l.lineWidth,u+pick(h.lineWidthPlus,l.lineWidthPlus,0)),p=h.fillColor||l.fillColor||p,c=h.lineColor||l.lineColor||c,m=pick(h.opacity,l.opacity,m)),{stroke:c,"stroke-width":u,fill:p,opacity:m}}destroy(i){const s=this,t=s.chart,r=/AppleWebKit\/533/.test(win.navigator.userAgent),e=s.data||[];let o,a,n;for(fireEvent(s,"destroy",{keepEventsForUpdate:i}),this.removeEvents(i),(s.axisTypes||[]).forEach(function(t){(n=s[t])?.series&&(erase(n.series,s),n.isDirty=n.forceRedraw=!0)}),s.legendItem&&s.chart.legend.destroyItem(s),a=e.length;a--;)e[a]?.destroy?.();for(const l of s.zones)destroyObjectProperties(l,void 0,!0);U.clearTimeout(s.animationTimeout),objectEach(s,function(t,e){t instanceof SVGElement&&!t.survive&&t[o=r&&"group"===e?"hide":"destroy"]()}),t.hoverSeries===s&&(t.hoverSeries=void 0),erase(t.series,s),t.orderItems("series"),objectEach(s,function(t,e){i&&"hcEvents"===e||delete s[e]})}applyZones(){const{area:u,chart:t,graph:m,zones:e,points:i,xAxis:g,yAxis:f,zoneAxis:s}=this,{inverted:y,renderer:v}=t,r=this[s+"Axis"],{isXAxis:x,len:a=0,minPointOffset:o=0}=r||{},n=(m?.strokeWidth()||0)/2+1,l=(t,e=0,i=0)=>{const{translated:s=0,lineClip:r}=t,o=(i=y?a-i:i)-s;r?.push(["L",e,Math.abs(o)<n?i-n*(o<=0?-1:1):s])};if(e.length&&(m||u)&&r&&isNumber(r.min)){const C=r.getExtremes().max+o,S=i=>{i.forEach((t,e)=>{"M"!==t[0]&&"L"!==t[0]||(i[e]=[t[0],x?a-t[1]:t[1],x?t[2]:a-t[2]])})};if(e.forEach(t=>{t.lineClip=[],t.translated=clamp(r.toPixels(pick(t.value,C),!0)||0,0,a)}),m&&!this.showLine&&m.hide(),u&&u.hide(),"y"===s&&i.length<g.len)for(const T of i){var{plotX:h,plotY:d,zone:b}=T,k=b&&e[e.indexOf(b)-1];b&&l(b,h,d),k&&l(k,h,d)}let p=[],c=r.toPixels(r.getExtremes().min-o,!0);e.forEach(t=>{const e=t.lineClip||[],i=Math.round(t.translated||0);g.reversed&&e.reverse();let{clip:s,simpleClip:r}=t,o=0,a=0,n=g.len,l=f.len;x?(o=i,n=c):(a=i,l=c);var h=[["M",o,a],["L",n,a],["L",n,l],["L",o,l],["Z"]],d=[h[0],...e,h[1],h[2],...p,h[3],h[4]];p=e.reverse(),c=i,y&&(S(d),u&&S(h)),s?(s.animate({d:d}),r?.animate({d:h})):(s=t.clip=v.path(d),u&&(r=t.simpleClip=v.path(h))),m&&t.graph?.clip(s),u&&t.area?.clip(r)})}else this.visible&&(m&&m.show(),u&&u.show())}plotGroup(t,e,i,s,r){let o=this[t];const a=!o,n={visibility:i,zIndex:s||.1};return defined(this.opacity)&&!this.chart.styledMode&&"inactive"!==this.state&&(n.opacity=this.opacity),o||(this[t]=o=this.chart.renderer.g().add(r)),o.addClass("highcharts-"+e+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(defined(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(o.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),o.attr(n)[a?"attr":"animate"](this.getPlotBox(e)),o}getPlotBox(t){let e=this.xAxis,i=this.yAxis;var s=this.chart,r=s.inverted&&!s.polar&&e&&this.invertible&&"series"===t,s=(s.inverted&&(e=i,i=this.xAxis),{scale:1,translateX:e?e.left:s.plotLeft,translateY:i?i.top:s.plotTop,name:t}),{scale:t,translateX:s,translateY:o}=(fireEvent(this,"getPlotBox",s),s);return{translateX:s,translateY:o,rotation:r?90:0,rotationOriginX:r?t*(e.len-i.len)/2:0,rotationOriginY:r?t*(e.len+i.len)/2:0,scaleX:r?-t:t,scaleY:t}}removeEvents(t){const e=this["eventsToUnbind"];t||removeEvent(this),e.length&&(e.forEach(t=>{t()}),e.length=0)}render(){const t=this,{chart:e,options:i,hasRendered:s}=t,r=animObject(i.animation),o=t.visible?"inherit":"hidden",a=i.zIndex,n=e.seriesGroup;let l=t.finishedAnimating?0:r.duration;fireEvent(this,"render"),t.plotGroup("group","series",o,a,n),t.markerGroup=t.plotGroup("markerGroup","markers",o,a,n),!1!==i.clip&&t.setClip(),l&&t.animate?.(!0),t.drawGraph&&(t.drawGraph(),t.applyZones()),t.visible&&t.drawPoints(),t.drawDataLabels?.(),t.redrawPoints?.(),i.enableMouseTracking&&t.drawTracker?.(),l&&t.animate?.(),s||(l&&r.defer&&(l+=r.defer),t.animationTimeout=syncTimeout(()=>{t.afterAnimate()},l||0)),t.isDirty=!1,t.hasRendered=!0,fireEvent(t,"afterRender")}redraw(){var t=this.isDirty||this.isDirtyData;this.translate(),this.render(),t&&delete this.kdTree}reserveSpace(){return this.visible||!this.chart.options.chart.ignoreHiddenSeries}searchPoint(t,e){var{xAxis:i,yAxis:s}=this,r=this.chart.inverted;return this.searchKDTree({clientX:r?i.len-t.chartY+i.pos:t.chartX-i.pos,plotY:r?s.len-t.chartX+s.pos:t.chartY-s.pos},e,t)}buildKDTree(t){this.buildingKdTree=!0;const n=this,e=n.options,i=-1<e.findNearestPointBy.indexOf("y")?2:1;delete n.kdTree,syncTimeout(function(){n.kdTree=function t(e,i,s){var r=e?.length;let o,a;if(r)return o=n.kdAxisArray[i%s],e.sort((t,e)=>(t[o]||0)-(e[o]||0)),{point:e[a=Math.floor(r/2)],left:t(e.slice(0,a),i+1,s),right:t(e.slice(a+1),i+1,s)}}(n.getValidPoints(void 0,!n.directTouch,e?.nullInteraction),i,i),n.buildingKdTree=!1},e.kdNow||"touchstart"===t?.type?0:1)}searchKDTree(t,e,i,s,r){const c=this,[u,m]=this.kdAxisArray,g=e?"distX":"dist",o=-1<(c.options.findNearestPointBy||"").indexOf("y")?2:1,f=!!c.isBubble,y=s||((t,e,i)=>{var s=t[i]||0,i=e[i]||0;return[s===i&&t.index>e.index||s<i?t:e,!1]}),v=r||((t,e)=>t<e);function x(t,e,i,s){var r=e.point,o=c.kdAxisArray[i%s];let a=r,n=!1;d=r,p=(l=t)[u],h=d[u],p=defined(p)&&defined(h)?p-h:null,h=l[m],l=d[m],h=defined(h)&&defined(l)?h-l:0,l=f&&d.marker?.radius||0,d.dist=Math.sqrt((p&&p*p||0)+h*h)-l,d.distX=defined(p)?Math.abs(p)-l:Number.MAX_VALUE;var l,h=(t[o]||0)-(r[o]||0)+(f&&r.marker?.radius||0),d=h<0?"left":"right",p=h<0?"right":"left";return e[d]&&([a,n]=y(r,x(t,e[d],i+1,s),g)),e[p]&&(l=Math.sqrt(h*h),o=a[g],v(l,o,n)&&(a=y(a,x(t,e[p],i+1,s),g)[0])),a}if(this.kdTree||this.buildingKdTree||this.buildKDTree(i),this.kdTree)return x(t,this.kdTree,o,o)}pointPlacementToXValue(){var{options:t,xAxis:e}=this;let i=t.pointPlacement;return"between"===i&&(i=e.reversed?-.5:.5),isNumber(i)?i*(t.pointRange||e.pointRange):0}isPointInside(t){var{chart:e,xAxis:i,yAxis:s}=this,{plotX:t=-1,plotY:r=-1}=t;return 0<=r&&r<=(s?s.len:e.plotHeight)&&0<=t&&t<=(i?i.len:e.plotWidth)}drawTracker(){const t=this,e=t.options,i=e.trackByArea,s=[].concat((i?t.areaPath:t.graphPath)||[]),r=t.chart,o=r.pointer,a=r.renderer,n=r.options.tooltip?.snap||0,l=()=>{e.enableMouseTracking&&r.hoverSeries!==t&&t.onMouseOver()},h="rgba(192,192,192,"+(svg?1e-4:.002)+")";let d=t.tracker;d?d.attr({d:s}):t.graph&&(t.tracker=d=a.path(s).attr({visibility:t.visible?"inherit":"hidden",zIndex:2}).addClass(i?"highcharts-tracker-area":"highcharts-tracker-line").add(t.group),r.styledMode||d.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:h,fill:i?h:"none","stroke-width":t.graph.strokeWidth()+(i?0:2*n)}),[t.tracker,t.markerGroup,t.dataLabelsGroup].forEach(t=>{t&&(t.addClass("highcharts-tracker").on("mouseover",l).on("mouseout",t=>{o?.onTrackerMouseOut(t)}),e.cursor&&!r.styledMode&&t.css({cursor:e.cursor}),t.on("touchstart",l))})),fireEvent(this,"afterDrawTracker")}addPoint(t,e,i,s,r){const o=this,a=o.options,{chart:n,data:l,dataTable:h,xAxis:d}=o,p=d?.hasNames&&d.names,c=a.data,u=o.getColumn("x");let m,g;e=pick(e,!0);var f={series:o},y=(o.pointClass.prototype.applyOptions.apply(f,[t]),f.x);if(g=u.length,o.requireSorting&&y<u[g-1])for(m=!0;g&&u[g-1]>y;)g--;h.setRow(f,g,!0,{addColumns:!1}),p&&f.name&&(p[y]=f.name),c?.splice(g,0,t),(m||o.processedData)&&(o.data.splice(g,0,null),o.processData()),"point"===a.legendType&&o.generatePoints(),i&&(l[0]&&l[0].remove?l[0].remove(!1):([l,c].filter(defined).forEach(t=>{t.shift()}),h.deleteRows(0))),!1!==r&&fireEvent(o,"addPoint",{point:f}),o.isDirty=!0,o.isDirtyData=!0,e&&n.redraw(s)}removePoint(e,t,i){function s(){[n?.length===a.length?n:void 0,a,r.options.data].filter(defined).forEach(t=>{t.splice(e,1)}),l.deleteRows(e),h?.destroy(),r.isDirty=!0,r.isDirtyData=!0,t&&o.redraw()}const r=this,{chart:o,data:a,points:n,dataTable:l}=r,h=a[e];setAnimation(i,o),t=pick(t,!0),h?h.firePointEvent("remove",null,s):s()}remove(t,e,i,s){const r=this,o=r.chart;function a(){r.destroy(s),o.isDirtyLegend=o.isDirtyBox=!0,o.linkSeries(s),pick(t,!0)&&o.redraw(e)}!1!==i?fireEvent(r,"remove",null,a):a()}update(t,e){t=diffObjects(t,this.userOptions),fireEvent(this,"update",{options:t});const i=this,s=i.chart,r=i.userOptions,o=i.initialType||i.type,a=s.options.plotOptions,n=seriesTypes[o].prototype,l=i.finishedAnimating&&{animation:!1},h={};let d,p,c=Series.keepProps.slice(),u=t.type||r.type||s.options.chart.type;var m=!(this.hasDerivedData||u&&u!==this.type||void 0!==t.keys||void 0!==t.pointStart||void 0!==t.pointInterval||void 0!==t.relativeXValue||t.joinBy||t.mapData||["dataGrouping","pointStart","pointInterval","pointIntervalUnit","keys"].some(t=>i.hasOptionChanged(t)));u=u||o,m?(c.push.apply(c,Series.keepPropsForPoints),!1!==t.visible&&c.push("area","graph"),i.parallelArrays.forEach(function(t){c.push(t+"Data")}),t.data&&(t.dataSorting&&extend(i.options.dataSorting,t.dataSorting),this.setData(t.data,!1))):this.dataTable.modified=this.dataTable,t=merge(r,{index:(void 0===r.index?i:r).index,pointStart:a?.series?.pointStart??r.pointStart??i.getColumn("x")[0]},!m&&{data:i.options.data},t,l),m&&t.data&&(t.data=i.options.data),(c=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(c)).forEach(function(t){c[t]=i[t],delete i[t]});let g=!1;if(seriesTypes[u]){if(g=u!==i.type,i.remove(!1,!1,!1,!0),g)if(s.propFromSeries(),Object.setPrototypeOf)Object.setPrototypeOf(i,seriesTypes[u].prototype);else{var f=Object.hasOwnProperty.call(i,"hcEvents")&&i.hcEvents;for(p in n)i[p]=void 0;extend(i,seriesTypes[u].prototype),f?i.hcEvents=f:delete i.hcEvents}}else error(17,!0,s,{missingModuleFor:u});if(c.forEach(function(t){i[t]=c[t]}),i.init(s,t),m&&this.points){!1===(d=i.options).visible?(h.graphic=1,h.dataLabel=1):(this.hasMarkerChanged(d,r)&&(h.graphic=1),i.hasDataLabels?.()||(h.dataLabel=1));for(const y of this.points)y?.series&&(y.resolveColor(),Object.keys(h).length&&y.destroyElements(h),!1===d.showInLegend&&y.legendItem&&s.legend.destroyItem(y))}i.initialType=o,s.linkSeries(),s.setSortedData(),g&&i.linkedSeries.length&&(i.isDirtyData=!0),fireEvent(this,"afterUpdate"),pick(e,!0)&&s.redraw(m&&void 0)}setName(t){this.name=this.options.name=this.userOptions.name=t,this.chart.isDirtyLegend=!0}hasOptionChanged(t){var e=this.chart,i=this.options[t],e=e.options.plotOptions,s=this.userOptions[t],e=pick(e?.[this.type]?.[t],e?.series?.[t]);return s&&!defined(e)?i!==s:i!==pick(e,i)}onMouseOver(){const t=this,e=t.chart,i=e.hoverSeries,s=e.pointer;s?.setHoverChartIndex(),i&&i!==t&&i.onMouseOut(),t.options.events.mouseOver&&fireEvent(t,"mouseOver"),t.setState("hover"),e.hoverSeries=t}onMouseOut(){const t=this,e=t.options,i=t.chart,s=i.tooltip,r=i.hoverPoint;i.hoverSeries=null,r&&r.onMouseOut(),t&&e.events.mouseOut&&fireEvent(t,"mouseOut"),!s||t.stickyTracking||s.shared&&!t.noSharedTooltip||s.hide(),i.series.forEach(function(t){t.setState("",!0)})}setState(e,t){const i=this,s=i.options,r=i.graph,o=s.inactiveOtherPoints,a=s.states,n=pick(a[e||"normal"]&&a[e||"normal"].animation,i.chart.options.chart.animation);let l=s.lineWidth,h=s.opacity;if(e=e||"",i.state!==e&&([i.group,i.markerGroup,i.dataLabelsGroup].forEach(function(t){t&&(i.state&&t.removeClass("highcharts-series-"+i.state),e&&t.addClass("highcharts-series-"+e))}),i.state=e,!i.chart.styledMode)){if(a[e]&&!1===a[e].enabled)return;if(e&&(l=a[e].lineWidth||l+(a[e].lineWidthPlus||0),h=pick(a[e].opacity,h)),r&&!r.dashstyle&&isNumber(l))for(const d of[r,...this.zones.map(t=>t.graph)])d?.animate({"stroke-width":l},n);o||[i.group,i.markerGroup,i.dataLabelsGroup,i.labelBySeries].forEach(function(t){t&&t.animate({opacity:h},n)})}t&&o&&i.points&&i.setAllPointsToState(e||void 0)}setAllPointsToState(e){this.points.forEach(function(t){t.setState&&t.setState(e)})}setVisible(e,t){const i=this,s=i.chart,r=s.options.chart.ignoreHiddenSeries,o=i.visible,a=(i.visible=e=i.options.visible=i.userOptions.visible=void 0===e?!o:e,e?"show":"hide");["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(t=>{i[t]?.[a]()}),s.hoverSeries!==i&&s.hoverPoint?.series!==i||i.onMouseOut(),i.legendItem&&s.legend.colorizeItem(i,e),i.isDirty=!0,i.options.stacking&&s.series.forEach(t=>{t.options.stacking&&t.visible&&(t.isDirty=!0)}),i.linkedSeries.forEach(t=>{t.setVisible(e,!1)}),r&&(s.isDirtyBox=!0),fireEvent(i,a),!1!==t&&s.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(t){var e=this;e.selected=t=this.options.selected=void 0===t?!e.selected:t,e.checkbox&&(e.checkbox.checked=t),fireEvent(e,t?"select":"unselect")}shouldShowTooltip(t,e,i={}){return i.series=this,i.visiblePlotOnly=!0,this.chart.isInsidePlot(t,e,i)}drawLegendSymbol(t,e){LegendSymbol[this.options.legendSymbol||"rectangle"]?.call(this,t,e)}}Series.defaultOptions=SeriesDefaults,Series.types=SeriesRegistry.seriesTypes,Series.registerType=SeriesRegistry.registerSeriesType,Series.keepProps=["colorIndex","eventOptions","navigatorSeries","symbolIndex","baseSeries"],Series.keepPropsForPoints=["data","isDirtyData","isDirtyCanvas","points","dataTable","processedData","xIncrement","cropped","_hasPointMarkers","hasDataLabels","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX","transformGroups"],extend(Series.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,directTouch:!1,invertible:!0,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:Point,requireSorting:!0,sorted:!0});export default SeriesRegistry.series=Series;