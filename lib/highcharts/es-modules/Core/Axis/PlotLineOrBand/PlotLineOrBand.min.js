"use strict";import PlotLineOrBandAxis from"./PlotLineOrBandAxis.js";import U from"../../Utilities.js";const{addEvent,arrayMax,arrayMin,defined,destroyObjectProperties,erase,fireEvent,merge,objectEach,pick}=U;class PlotLineOrBand{static compose(e,t){return addEvent(e,"afterInit",function(){this.labelCollectors.push(()=>{const e=[];for(const s of this.axes)for(var{label:t,options:i}of s.plotLinesAndBands)t&&!i?.label?.allowOverlap&&e.push(t);return e})}),PlotLineOrBandAxis.compose(PlotLineOrBand,t)}constructor(e,t){this.axis=e,this.options=t,this.id=t.id}render(){fireEvent(this,"render");const{axis:e,options:t}=this,{horiz:i,logarithmic:s}=e,{color:r,events:a,zIndex:n=0}=t,{renderer:l,time:d}=e.chart,o={},h=d.parse(t.to),c=d.parse(t.from),f=d.parse(t.value),p=t.borderWidth;let g=t.label,{label:x,svgElem:y}=this,b=[],m;const u=defined(c)&&defined(h),v=defined(f),L=!y,A={class:"highcharts-plot-"+(u?"band ":"line ")+(t.className||"")};var P=u?"bands":"lines";if(e.chart.styledMode||(v?(A.stroke=r||"#999999",A["stroke-width"]=pick(t.width,1),t.dashStyle&&(A.dashstyle=t.dashStyle)):u&&(A.fill=r||"#e6e9ff",p&&(A.stroke=t.borderColor,A["stroke-width"]=p))),P+="-"+(o.zIndex=n),(m=e.plotLinesAndBandsGroups[P])||(e.plotLinesAndBandsGroups[P]=m=l.g("plot-"+P).attr(o).add()),y||(this.svgElem=y=l.path().attr(A).add(m)),defined(f))b=e.getPlotLinePath({value:s?.log2lin(f)??f,lineWidth:y.strokeWidth(),acrossPanes:t.acrossPanes});else{if(!defined(c)||!defined(h))return;b=e.getPlotBandPath(s?.log2lin(c)??c,s?.log2lin(h)??h,t)}return!this.eventsAdded&&a&&(objectEach(a,(e,t)=>{y?.on(t,e=>{a[t].apply(this,[e])})}),this.eventsAdded=!0),!L&&y.d||!b?.length?y&&(b?(y.show(),y.animate({d:b})):y.d&&(y.hide(),x&&(this.label=x=x.destroy()))):y.attr({d:b}),g&&(defined(g.text)||defined(g.formatter))&&b?.length&&0<e.width&&0<e.height&&!b.isFlat?(g=merge({align:i&&u?"center":void 0,x:i?!u&&4:10,verticalAlign:!i&&u?"middle":void 0,y:i?u?16:10:u?6:-4,rotation:i&&!u?90:0,...u?{inside:!0}:{}},g),this.renderLabel(g,b,u,n)):x&&x.hide(),this}renderLabel(e,t,i,s){const r=this,a=r.axis,n=a.chart.renderer,l=e.inside;let d=r.label;d||(r.label=d=n.text(this.getLabelText(e),0,0,e.useHTML).attr({align:e.textAlign||e.align,rotation:e.rotation,class:"highcharts-plot-"+(i?"band":"line")+"-label "+(e.className||""),zIndex:s}),a.chart.styledMode||d.css(merge({color:a.chart.options.title?.style.color,fontSize:"0.8em",textOverflow:i&&!l?"":"ellipsis"},e.style)),d.add());var s=t.xBounds||[t[0][1],t[1][1],(i?t[2]:t[0])[1]],t=t.yBounds||[t[0][2],t[1][2],(i?t[2]:t[0])[2]],o=arrayMin(s),h=arrayMin(t),s=arrayMax(s)-o;d.align(e,!1,{x:o,y:h,width:s,height:arrayMax(t)-h}),d.alignAttr.y-=n.fontMetrics(d).b,d.alignValue&&"left"!==d.alignValue&&!defined(l)||d.css({width:(e.style?.width||(i&&l?s:90===d.rotation?a.height-(d.alignAttr.y-a.top):(e.clip?a.width:a.chart.chartWidth)-(d.alignAttr.x-a.left)))+"px"}),d.show(!0)}getLabelText(e){return defined(e.formatter)?e.formatter.call(this):e.text}destroy(){erase(this.axis.plotLinesAndBands,this),delete this.axis,destroyObjectProperties(this)}}export default PlotLineOrBand;