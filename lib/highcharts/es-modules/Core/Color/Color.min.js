"use strict";import H from"../Globals.js";const win=H["win"];import U from"../Utilities.js";const{isNumber,isString,merge,pInt,defined}=U,colorMix=(t,r,s)=>`color-mix(in srgb,${t},${r} ${100*s}%)`,isStringColor=t=>isString(t)&&!!t&&"none"!==t;class Color{static parse(t){return t?new Color(t):Color.None}constructor(t){this.rgba=[NaN,NaN,NaN,NaN],this.input=t;const r=H.Color;if(r&&r!==Color)return new r(t);let s,o,i,e;if("object"==typeof t&&void 0!==t.stops)this.stops=t.stops.map(t=>new Color(t[1]));else if("string"==typeof t)for(this.input=t=Color.names[t.toLowerCase()]||t,i=Color.parsers.length;i--&&!o;)(s=(e=Color.parsers[i]).regex.exec(t))&&(o=e.parse(s));o&&(this.rgba=o)}get(s){const t=this.input,r=this.rgba;if(this.output)return this.output;if("object"!=typeof t||void 0===this.stops)return r&&isNumber(r[0])?"rgb"===s||!s&&1===r[3]?"rgb("+r[0]+","+r[1]+","+r[2]+")":"a"===s?""+r[3]:"rgba("+r.join(",")+")":t;{const o=merge(t);return o.stops=[].slice.call(o.stops),this.stops.forEach((t,r)=>{o.stops[r]=[o.stops[r][0],t.get(s)]}),o}}brighten(r){const s=this.rgba;if(this.stops)this.stops.forEach(function(t){t.brighten(r)});else if(isNumber(r)&&0!==r)if(isNumber(s[0]))for(let t=0;t<3;t++)s[t]+=pInt(255*r),s[t]<0&&(s[t]=0),255<s[t]&&(s[t]=255);else Color.useColorMix&&isStringColor(this.input)&&(this.output=colorMix(this.input,0<r?"white":"black",Math.abs(r)));return this}setOpacity(t){return this.rgba[3]=t,this}tweenTo(t,s){const o=this.rgba,r=t.rgba;if(!isNumber(o[0])||!isNumber(r[0]))return Color.useColorMix&&isStringColor(this.input)&&isStringColor(t.input)&&s<.99?colorMix(this.input,t.input,s):t.input||"none";const i=1!==r[3]||1!==o[3],e=(t,r)=>t+(o[r]-t)*(1-s),n=r.slice(0,3).map(e).map(Math.round);return i&&n.push(e(r[3],3)),(i?"rgba(":"rgb(")+n.join(",")+")"}}Color.names={white:"#ffffff",black:"#000000"},Color.parsers=[{regex:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?(?:\.\d+)?)\s*\)/,parse:function(t){return[pInt(t[1]),pInt(t[2]),pInt(t[3]),parseFloat(t[4],10)]}},{regex:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,parse:function(t){return[pInt(t[1]),pInt(t[2]),pInt(t[3]),1]}},{regex:/^#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?$/i,parse:function(t){return[pInt(t[1]+t[1],16),pInt(t[2]+t[2],16),pInt(t[3]+t[3],16),defined(t[4])?pInt(t[4]+t[4],16)/255:1]}},{regex:/^#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?$/i,parse:function(t){return[pInt(t[1],16),pInt(t[2],16),pInt(t[3],16),defined(t[4])?pInt(t[4],16)/255:1]}}],Color.useColorMix=win.CSS?.supports("color","color-mix(in srgb,red,blue 9%)"),Color.None=new Color("");export default Color;