"use strict";import G from"../Core/Globals.js";const win=G["win"];import U from"../Core/Utilities.js";const{discardElement,objectEach}=U;function ajax(a){const t={json:"application/json",xml:"application/xml",text:"text/plain",octet:"application/octet-stream"},n=new XMLHttpRequest;function e(t,e){a.error&&a.error(t,e)}if(!a.url)return!1;n.open((a.type||"get").toUpperCase(),a.url,!0),a.headers?.["Content-Type"]||n.setRequestHeader("Content-Type",t[a.dataType||"json"]||t.text),objectEach(a.headers,function(t,e){n.setRequestHeader(e,t)}),a.responseType&&(n.responseType=a.responseType),n.onreadystatechange=function(){let t;if(4===n.readyState){if(200===n.status){if("blob"!==a.responseType&&(t=n.responseText,"json"===a.dataType))try{t=JSON.parse(t)}catch(t){if(t instanceof Error)return e(n,t)}return a.success?.(t,n)}e(n,n.responseText)}},a.data&&"string"!=typeof a.data&&(a.data=JSON.stringify(a.data)),n.send(a.data)}function getJSON(t,e){HttpUtilities.ajax({url:t,success:e,dataType:"json",headers:{"Content-Type":"text/plain"}})}async function post(t,e,a){const n=new win.FormData,s=(objectEach(e,function(t,e){n.append(e,t)}),n.append("b64","true"),await win.fetch(t,{method:"POST",body:n,...a}));if(s.ok){t=await s.text();const o=document.createElement("a");o.href=`data:${e.type};base64,`+t,o.download=e.filename,o.click(),discardElement(o)}}const HttpUtilities={ajax:ajax,getJSON:getJSON,post:post};export default HttpUtilities;