"use strict";import DataLabel from"../../Core/Series/DataLabel.js";import H from"../../Core/Globals.js";const{composed,noop}=H;import R from"../../Core/Renderer/RendererUtilities.js";const distribute=R["distribute"];import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const Series=SeriesRegistry["series"];import U from"../../Core/Utilities.js";const{arrayMax,clamp,defined,pick,pushUnique,relativeLength}=U;var ColumnDataLabel;!function(t){const e={radialDistributionY:function(t,a){return(a.dataLabelPosition?.top||0)+t.distributeBox.pos},radialDistributionX:function(t,a,e,i,o){var s=o.dataLabelPosition;return t.getX(e<(s?.top||0)+2||e>(s?.bottom||0)-2?i:e,a.half,a,o)},justify:function(t,a,e,i){return i[0]+(t.half?-1:1)*(e+(a.dataLabelPosition?.distance||0))},alignToPlotEdges:function(t,a,e,i){t=t.getBBox().width;return a?t+i:e-t-i},alignToConnectors:function(t,a,e,i){let o=0,s;return t.forEach(function(t){(s=t.dataLabel.getBBox().width)>o&&(o=s)}),a?o+i:e-o-i}};function i(t,a){var e=Math.PI/2,{start:i=0,end:o=0}=t.shapeArgs||{};let s=t.angle||0;0<a&&i<e&&e<o&&s>e/2&&s<1.5*e&&(s=s<=e?Math.max(e/2,(i+e)/2):Math.min(1.5*e,(e+o)/2));var{center:i,options:e}=this,o=i[2]/2,r=Math.cos(s),n=Math.sin(s),l=i[0]+r*o,i=i[1]+n*o,o=Math.min((e.slicedOffset||0)+(e.borderWidth||0),a/5);return{natural:{x:l+r*a,y:i+n*a},computed:{},alignment:a<0?"center":t.half?"right":"left",connectorPosition:{angle:s,breakAt:{x:l+r*o,y:i+n*o},touchingSliceAt:{x:l,y:i}},distance:a}}function o(){const m=this,t=m.points,r=m.chart,g=r.plotWidth,x=r.plotHeight,L=r.plotLeft,s=Math.round(r.chartWidth/3),M=m.center,y=M[2]/2,n=M[1],l=[[],[]],v=[0,0,0,0],w=m.dataLabelPositioners;let h,D,B,d=0;m.visible&&m.hasDataLabels?.()&&(t.forEach(t=>{(t.dataLabels||[]).forEach(t=>{t.shortened&&(t.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),t.shortened=!1)})}),Series.prototype.drawDataLabels.apply(m),t.forEach(o=>{(o.dataLabels||[]).forEach((t,a)=>{var e=M[2]/2,i=t.options,e=relativeLength(i?.distance||0,e);0===a&&l[o.half].push(o),defined(i?.style?.width)||t.getBBox().width>s&&(t.css({width:Math.round(.7*s)+"px"}),t.shortened=!0),t.dataLabelPosition=this.getDataLabelPosition(o,e),d=Math.max(d,e)})}),l.forEach((u,p)=>{const t=u.length,f=[];let a,e,i=0,o;t&&(m.sortByAngle(u,p-.5),0<d&&(a=Math.max(0,n-y-d),e=Math.min(n+y+d,r.plotHeight),u.forEach(e=>{(e.dataLabels||[]).forEach(t=>{const a=t.dataLabelPosition;a&&0<a.distance&&(a.top=Math.max(0,n-y-a.distance),a.bottom=Math.min(n+y+a.distance,r.plotHeight),i=t.getBBox().height||21,t.lineHeight=r.renderer.fontMetrics(t.text||t).h+2*t.padding,e.distributeBox={target:(t.dataLabelPosition?.natural.y||0)-a.top+t.lineHeight/2,size:i,rank:e.y},f.push(e.distributeBox))})}),o=e+i-a,distribute(f,o,o/5)),u.forEach(b=>{(b.dataLabels||[]).forEach(a=>{const t=a.options||{},e=b.distributeBox,i=a.dataLabelPosition,o=i?.natural.y||0,s=t.connectorPadding||0,r=a.lineHeight||21,n=a.getBBox(),l=(r-n.height)/2;let h=0,d=o,c="inherit";if(i){if(f&&defined(e)&&0<i.distance&&(void 0===e.pos?c="hidden":(B=e.size,d=w.radialDistributionY(b,a))),t.justify)h=w.justify(b,a,y,M);else switch(t.alignTo){case"connectors":h=w.alignToConnectors(u,p,g,L);break;case"plotEdges":h=w.alignToPlotEdges(a,p,g,L);break;default:h=w.radialDistributionX(m,b,d-l,o,a)}if(i.attribs={visibility:c,align:i.alignment},i.posAttribs={x:h+(t.x||0)+({left:s,right:-s}[i.alignment]||0),y:d+(t.y||0)-r/2},i.computed.x=h,i.computed.y=d-l,pick(t.crop,!0)){D=a.getBBox().width;let t;h-D<s&&1===p?(t=Math.round(D-h+s),v[3]=Math.max(t,v[3])):h+D>g-s&&0===p&&(t=Math.round(h+D-g+s),v[1]=Math.max(t,v[1])),d-B/2<0?v[0]=Math.max(Math.round(-d+B/2),v[0]):d+B/2>x&&(v[2]=Math.max(Math.round(d+B/2-x),v[2])),i.sideOverflow=t}}})}))}),0!==arrayMax(v)&&!this.verifyDataLabelOverflow(v)||(this.placeDataLabels(),this.points.forEach(s=>{(s.dataLabels||[]).forEach(t=>{var a,{connectorColor:e,connectorWidth:i=1}=t.options||{},o=t.dataLabelPosition;i&&(h=t.connector,o&&0<o.distance?(a=!h,h||(t.connector=h=r.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+s.colorIndex+(s.className?" "+s.className:"")).add(m.dataLabelsGroup)),r.styledMode||h.attr({"stroke-width":i,stroke:e||s.color||"#666666"}),h[a?"attr":"animate"]({d:s.getConnectorPath(t)}),h.attr({visibility:o.attribs?.visibility})):h&&(t.connector=h.destroy()))})})))}function s(){this.points.forEach(t=>{(t.dataLabels||[]).forEach(t=>{var a=t.dataLabelPosition;a?(a.sideOverflow&&(t.css({width:Math.max(t.getBBox().width-a.sideOverflow,0)+"px",textOverflow:t.options?.style?.textOverflow||"ellipsis"}),t.shortened=!0),t.attr(a.attribs),t[t.moved?"animate":"attr"](a.posAttribs),t.moved=!0):t&&t.attr({y:-9999})}),delete t.distributeBox},this)}function r(t){const a=this.center,e=this.options,i=e.center,o=e.minSize||80;let s=o,r=null!==e.size;return r||(null!==i[0]?s=Math.max(a[2]-Math.max(t[1],t[3]),o):(s=Math.max(a[2]-t[1]-t[3],o),a[0]+=(t[3]-t[1])/2),null!==i[1]?s=clamp(s,o,a[2]-Math.max(t[0],t[2])):(s=clamp(s,o,a[2]-t[0]-t[2]),a[1]+=(t[0]-t[2])/2),s<a[2]?(a[2]=s,a[3]=Math.min(e.thickness?Math.max(0,s-2*e.thickness):Math.max(0,relativeLength(e.innerSize||0,s)),s),this.translate(a),this.drawDataLabels&&this.drawDataLabels()):r=!0),r}t.compose=function(t){if(DataLabel.compose(Series),pushUnique(composed,"PieDataLabel")){const a=t.prototype;a.dataLabelPositioners=e,a.alignDataLabel=noop,a.drawDataLabels=o,a.getDataLabelPosition=i,a.placeDataLabels=s,a.verifyDataLabelOverflow=r}}}(ColumnDataLabel=ColumnDataLabel||{});export default ColumnDataLabel;