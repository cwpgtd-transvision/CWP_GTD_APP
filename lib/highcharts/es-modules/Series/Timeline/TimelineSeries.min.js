"use strict";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const{column:ColumnSeries,line:LineSeries}=SeriesRegistry.seriesTypes;import TimelinePoint from"./TimelinePoint.js";import TimelineSeriesDefaults from"./TimelineSeriesDefaults.js";import U from"../../Core/Utilities.js";const{addEvent,arrayMax,arrayMin,defined,extend,merge,pick}=U;class TimelineSeries extends LineSeries{alignDataLabel(e,t,i,s){const n=this,a=n.chart.inverted,r=n.visibilityMap.filter(e=>!!e),o=n.visiblePointsCount||0,l=r.indexOf(e),d=!l||l===o-1,p=n.options.dataLabels,h=e.userDLOptions||{},u=p.alternate?d?1.5:2:1,c=Math.floor(n.xAxis.len/o),m=t.padding;let f,b,g;e.visible&&(f=Math.abs(h.x||e.options.dataLabels.x),g=a?(b=2*(f-m)-(e.itemHeight||0)/2,{width:pick(p.style?.width,.4*n.yAxis.len+"px"),textOverflow:(t.width||0)/b*(t.height||0)/2>c*u?"ellipsis":"none"}):{width:(h.width||p.width||c*u-2*m)+"px"},t.css(g),n.chart.styledMode||t.shadow(p.shadow)),super.alignDataLabel.apply(n,arguments)}bindAxes(){var e=this;super.bindAxes(),e.xAxis.userOptions.type||(e.xAxis.categories=e.xAxis.hasNames=!0)}distributeDL(){var e=this,t=e.options.dataLabels,i=e.chart.inverted;let s=1;if(t){var n=pick(t.distance,i?20:100);for(const a of e.points){const r={[i?"x":"y"]:t.alternate&&s%2?-n:n};i&&(r.align=t.alternate&&s%2?"right":"left"),a.options.dataLabels=merge(r,a.userDLOptions),s++}}}generatePoints(){super.generatePoints();const i=this.points,s=i.length,n=this.getColumn("x");for(let e=0,t=s;e<t;++e){var a=n[e];i[e].applyOptions({x:a},a)}}getVisibilityMap(){const e=this,t=e.options.nullInteraction,i=((e.data.length?e:e.options).data||[]).map(e=>!(!e||!1===e.visible||e.isNull&&!t)&&e);return i}getXExtremes(e){const i=this,t=e.filter((e,t)=>i.points[t].isValid()&&i.points[t].visible);return{min:arrayMin(t),max:arrayMax(t)}}init(){const s=this;super.init.apply(s,arguments),s.eventsToUnbind.push(addEvent(s,"afterTranslate",function(){let e,t=Number.MAX_VALUE;for(const i of s.points)i.isInside=i.isInside&&i.visible,!i.visible||i.isNull&&!s.options.nullInteraction||(defined(e)&&(t=Math.min(t,Math.abs(i.plotX-e))),e=i.plotX);s.closestPointRangePx=t})),s.eventsToUnbind.push(addEvent(s,"drawDataLabels",function(){s.distributeDL()})),s.eventsToUnbind.push(addEvent(s,"afterDrawDataLabels",function(){let e;for(const t of s.points)(e=t.dataLabel)&&(e.animate=function(e){return this.targetPosition&&(this.targetPosition=e),this.renderer.Element.prototype.animate.apply(this,arguments)},e.targetPosition||(e.targetPosition={}),t.drawConnector())})),s.eventsToUnbind.push(addEvent(s.chart,"afterHideOverlappingLabel",function(){for(const e of s.points)e.dataLabel&&e.dataLabel.connector&&e.dataLabel.oldOpacity!==e.dataLabel.newOpacity&&e.alignConnector()}))}markerAttribs(e,t){const i=this,s=i.options.marker,n=e.marker||{},a=n.symbol||s.symbol,r=pick(n.width,s.width,i.closestPointRangePx),o=pick(n.height,s.height);let l,d,p=0;if(i.xAxis.dateTime)return super.markerAttribs(e,t);t&&(l=s.states[t]||{},d=n.states&&n.states[t]||{},p=pick(d.radius,l.radius,p+(l.radiusPlus||0))),e.hasImage=a&&0===a.indexOf("url");t={x:Math.floor(e.plotX)-r/2-p/2,y:e.plotY-o/2-p/2,width:r+p,height:o+p};return i.chart.inverted?{y:t.x&&t.width&&i.xAxis.len-t.x-t.width,x:t.y,width:t.height,height:t.width}:t}}TimelineSeries.defaultOptions=merge(LineSeries.defaultOptions,TimelineSeriesDefaults),addEvent(TimelineSeries,"afterProcessData",function(){var e=this,t=e.getColumn("x");let i=0;e.visibilityMap=e.getVisibilityMap();for(const s of e.visibilityMap)s&&i++;e.visiblePointsCount=i,this.dataTable.setColumn("y",new Array(t.length).fill(1))}),extend(TimelineSeries.prototype,{drawTracker:ColumnSeries.prototype.drawTracker,pointClass:TimelinePoint,trackerGroups:["markerGroup","dataLabelsGroup"]}),SeriesRegistry.registerSeriesType("timeline",TimelineSeries);export default TimelineSeries;