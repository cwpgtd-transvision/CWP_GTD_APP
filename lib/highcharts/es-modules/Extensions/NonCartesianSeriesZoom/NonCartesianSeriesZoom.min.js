"use strict";import H from"../../Core/Globals.js";const composed=H["composed"];import U from"../../Core/Utilities.js";const{addEvent,pushUnique}=U;function onTransform(t){const x=this,{trigger:e,selection:o,reset:i,from:u={},to:X={}}=t,a=x.zooming.type;"xy"===a&&("mousewheel"===e||"pan"===e||o||i)&&x.series.forEach(m=>{if(!m.isCartesian&&!1!==m.options.zoomEnabled){m.isDirty=!0,x.isDirtyBox=!0,t.hasZoomed=!0;var{plotSizeX:c=0,plotSizeY:g=0}=x;if("pan"===e&&m.zooming)m.zooming.panX-=(X.x||0)/c,m.zooming.panY-=(X.y||0)/g;else if(Object.keys(u).length){var{width:d=1,height:z=1}=X,f=Math.abs(m.group?.scaleX||1);let{x:o=0,y:i=0,width:a=1,height:n=1}=u,s=o,r=i,p=m.zooming?.scale||m.group?.scaleX||1,l=(m.zooming?.width||1)*c,h=(m.zooming?.height||1)*g;if(Object.keys(X).length)l*=a/d,h*=a/z,o-=x.plotLeft,i-=x.plotTop,s=o-l/2,r=i-h/2,p=Math.min(c/l,g/h);else{a/=f,n/=f,p=Math.min(c/a,g/n);let t=0,e=0;m.zooming&&(t=m.zooming.x*c,e=m.zooming.y*g);d=(o-x.plotLeft)/(c-a*f||1),z=(i-x.plotTop)/(g-n*f||1);l=a,h=n,o-=x.plotLeft,i-=x.plotTop,o/=f,i/=f,o+=t+a*d,i+=e+n*z,s-=x.plotLeft,r-=x.plotTop,s/=f,r/=f,s+=t,r+=e}m.zooming={x:s/c,y:r/g,zoomX:o/c,zoomY:i/g,width:l/c,height:h/g,scale:p,panX:0,panY:0},p<1&&delete m.zooming}else delete m.zooming}})}function onGetPlotBox(t){const{chart:e,group:o,zooming:i}=this;let{plotSizeX:a=0,plotSizeY:n=0}=e,{scale:s,translateX:r,translateY:p,name:l}=t,h=0,m=0;var c=r,g=p;e.inverted&&([a,n]=[n,a]),o&&i&&(s=i.scale,h=i.zoomX*a*(s-Math.abs(o.scaleX||1)),m=i.zoomY*n*(s-Math.abs(o.scaleY||1)),"series"===l&&(i.x=Math.max(0,Math.min(1-i.width,i.x+i.panX/s)),h+=i.panX*a,i.panX=0,i.y=Math.max(0,Math.min(1-i.height,i.y+i.panY/s)),m+=i.panY*n,i.panY=0),r=(o.translateX||c)-h,(p=(o.translateY||g)-m)>g?p=g:(o.translateY||g)-m<n*(1-s)+g&&(p=n*(1-s)+g),r>c?r=c:r<a*(1-s)+c&&(r=a*(1-s)+c),t.scale=s,t.translateX=r,t.translateY=p)}function onAfterDrawChartBox(){var t=this;let e;t.series.find(t=>!!t.zooming)&&(t.zoomClipRect||(t.zoomClipRect=t.renderer.clipRect()),t.zoomClipRect.attr({x:t.plotLeft,y:t.plotTop,width:t.inverted?t.clipBox.height:t.clipBox.width,height:t.inverted?t.clipBox.width:t.clipBox.height}),e=t.zoomClipRect),t.seriesGroup?.clip(e),t.dataLabelsGroup?.clip(e)}function onGetAnchor(t){var e,o,i,a;t.point.series&&!t.point.series.isCartesian&&t.point.series.group&&t.point.series.zooming&&(e=t.point.series.chart,o=t.point.series.zooming.scale,i=t.point.series.group.translateX||0,a=t.point.series.group.translateY||0,t.ret[0]=t.ret[0]*o+i-e.plotLeft,t.ret[1]=t.ret[1]*o+a-e.plotTop)}function onAfterSetChartSize(t){t.skipAxes&&this.series.forEach(t=>{t.group&&t.zooming&&t.group.attr({translateX:0,translateY:0,scaleX:1,scaleY:1})})}class NonCartesianSeriesZoom{static compose(t,e,o){pushUnique(composed,"NonCartesianSeriesZoom")&&(addEvent(t,"afterDrawChartBox",onAfterDrawChartBox),addEvent(t,"transform",onTransform),addEvent(t,"afterSetChartSize",onAfterSetChartSize),addEvent(e,"getPlotBox",onGetPlotBox),addEvent(o,"getAnchor",onGetAnchor))}}export default NonCartesianSeriesZoom;