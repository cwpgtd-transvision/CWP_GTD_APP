"use strict";import D from"../../Core/Defaults.js";const defaultOptions=D["defaultOptions"];import H from"../../Core/Globals.js";const composed=H["composed"];import RangeSelectorDefaults from"./RangeSelectorDefaults.js";import U from"../../Core/Utilities.js";const{addEvent,defined,extend,isNumber,merge,pick,pushUnique}=U,chartDestroyEvents=[];let RangeSelectorConstructor;function axisMinFromRange(){function e(e,t){const o=i.toParts(e),r=o.slice();"year"===a?r[0]+=t:r[1]+=t;var n=i.makeTime.apply(i,r),n=i.toParts(n);return"month"===a&&o[1]===n[1]&&1===Math.abs(t)&&(r[0]=o[0],r[1]=o[1],r[2]=0),i.makeTime.apply(i,r)-e}const t=this.range,a=t.type,o=this.max,i=this.chart.time;let r,n;isNumber(t)?(r=o-t,n=t):t&&(r=o+e(o,-(t.count||1)),this.chart&&this.chart.setFixedRange(o-r));var s=pick(this.dataMin,Number.MIN_VALUE);return(r=isNumber(r)?r:s)<=s&&(r=s,void 0===n&&(n=e(r,t.count)),this.newMax=Math.min(r+n,pick(this.dataMax,Number.MAX_VALUE))),isNumber(o)?!isNumber(t)&&t&&t._offsetMin&&(r+=t._offsetMin):r=void 0,r}function updateRangeSelectorButtons(){this.rangeSelector?.redrawElements()}function compose(e,t,o){if(RangeSelectorConstructor=o,pushUnique(composed,"RangeSelector")){const r=t.prototype;e.prototype.minFromRange=axisMinFromRange,addEvent(t,"afterGetContainer",createRangeSelector),addEvent(t,"beforeRender",onChartBeforeRender),addEvent(t,"destroy",onChartDestroy),addEvent(t,"getMargins",onChartGetMargins),addEvent(t,"redraw",redrawRangeSelector),addEvent(t,"update",onChartUpdate),addEvent(t,"beforeRedraw",updateRangeSelectorButtons),r.callbacks.push(redrawRangeSelector),extend(defaultOptions,{rangeSelector:RangeSelectorDefaults.rangeSelector}),extend(defaultOptions.lang,RangeSelectorDefaults.lang)}}function createRangeSelector(){this.options.rangeSelector&&this.options.rangeSelector.enabled&&(this.rangeSelector=new RangeSelectorConstructor(this))}function onChartBeforeRender(){const e=this.rangeSelector;var t;e&&(isNumber(e.deferredYTDClick)&&(e.clickButton(e.deferredYTDClick),delete e.deferredYTDClick),t=e.options.verticalAlign,e.options.floating||("bottom"===t?this.extraBottomMargin=!0:"top"===t&&(this.extraTopMargin=!0)))}function redrawRangeSelector(){var t=this;const o=this.rangeSelector;if(o){let e;var r=t.xAxis[0].getExtremes();const a=t.legend;var n=o&&o.options.verticalAlign;isNumber(r.min)&&o.render(r.min,r.max),a.display&&"top"===n&&n===a.options.verticalAlign&&(e=merge(t.spacingBox),"vertical"===a.options.layout?e.y=t.plotTop:e.y+=o.getHeight(),a.group.placed=!1,a.align(e))}}function onChartDestroy(){for(let e=0,t=chartDestroyEvents.length;e<t;++e){const o=chartDestroyEvents[e];if(o[0]===this)return o[1].forEach(e=>e()),void chartDestroyEvents.splice(e,1)}}function onChartGetMargins(){const e=this.rangeSelector;var t,o;e?.options?.enabled&&(t=e.getHeight(),o=e.options.verticalAlign,e.options.floating||("bottom"===o?this.marginBottom+=t:"middle"!==o&&(this.plotTop+=t)))}function onChartUpdate(e){var e=e.options.rangeSelector,t=this.extraBottomMargin,o=this.extraTopMargin;let r=this.rangeSelector;e&&e.enabled&&!defined(r)&&this.options.rangeSelector&&(this.options.rangeSelector.enabled=!0,this.rangeSelector=r=new RangeSelectorConstructor(this)),this.extraBottomMargin=!1,this.extraTopMargin=!1,r&&(e=e&&e.verticalAlign||r.options&&r.options.verticalAlign,r.options.floating||("bottom"===e?this.extraBottomMargin=!0:"middle"!==e&&(this.extraTopMargin=!0)),this.extraBottomMargin===t&&this.extraTopMargin===o||(this.isDirtyBox=!0))}const RangeSelectorComposition={compose:compose};export default RangeSelectorComposition;