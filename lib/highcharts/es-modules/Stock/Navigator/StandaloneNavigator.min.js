"use strict";import Chart from"../../Core/Chart/Chart.js";import Navigator from"./Navigator.js";import G from"../../Core/Globals.js";import U from"../../Core/Utilities.js";import Axis from"../../Core/Axis/Axis.js";import standaloneNavigatorDefaults from"./StandaloneNavigatorDefaults.js";const{merge,addEvent,fireEvent,pick}=U;class StandaloneNavigator{static navigator(t,a){t=new StandaloneNavigator(t,a);return G.navigators?G.navigators.push(t):G.navigators=[t],t}constructor(t,a){this.boundAxes=[],this.userOptions=a,this.chartOptions=merge(G.getOptions(),standaloneNavigatorDefaults,a.chart,{navigator:a}),this.chartOptions.chart&&a.height&&(this.chartOptions.chart.height=a.height);const i=new Chart(t,this.chartOptions);i.options=merge(i.options,{navigator:{enabled:!0},scrollbar:{enabled:!0}}),this.chartOptions.navigator&&this.chartOptions.scrollbar&&(this.chartOptions.navigator.enabled=!0,this.chartOptions.scrollbar.enabled=!0),this.navigator=new Navigator(i),i.navigator=this.navigator,this.initNavigator()}bind(a,i=!0){const r=this,e=a instanceof Chart?a.xAxis[0]:a;if(e instanceof Axis){const{min:s,max:n}=this.navigator.xAxis,o=[];i&&(a=addEvent(e,"setExtremes",t=>{"pan"!==t.trigger&&"zoom"!==t.trigger&&"mousewheel"!==t.trigger||r.setRange(t.min,t.max,!0,"pan"!==t.trigger&&"mousewheel"!==t.trigger,{trigger:e})}),o.push(a));i=addEvent(this.navigator,"setRange",t=>{e.setExtremes(t.min,t.max,t.redraw,t.animation)});o.push(i);let t=this.boundAxes.filter(function(t){return t.axis===e})[0];t||(t={axis:e,callbacks:[]},this.boundAxes.push(t)),t.callbacks=o,e.series.forEach(t=>{t.options.showInNavigator&&r.addSeries(t.options)}),e.setExtremes(s,n),addEvent(e,"destroy",t=>{t.keepEvents||this.unbind(e)})}}unbind(t){if(!t)return this.boundAxes.forEach(({callbacks:t})=>{t.forEach(t=>t())}),void(this.boundAxes.length=0);var a=t instanceof Axis?t:t.xAxis[0];for(let t=this.boundAxes.length-1;0<=t;t--)this.boundAxes[t].axis===a&&(this.boundAxes[t].callbacks.forEach(t=>t()),this.boundAxes.splice(t,1))}destroy(){this.boundAxes.forEach(({callbacks:t})=>{t.forEach(t=>t())}),this.boundAxes.length=0,this.navigator.destroy(),this.navigator.chart.destroy()}update(t,a){this.chartOptions=merge(this.chartOptions,t.height&&{chart:{height:t.height}},t.chart,{navigator:t}),this.navigator.chart.update(this.chartOptions,a)}redraw(){this.navigator.chart.redraw()}addSeries(t){this.navigator.chart.addSeries(merge(t,{showInNavigator:pick(t.showInNavigator,!0)})),this.navigator.setBaseSeries()}initNavigator(){const t=this.navigator;t.top=1,t.xAxis.setScale(),t.yAxis.setScale(),t.xAxis.render(),t.yAxis.render(),t.series?.forEach(t=>{t.translate(),t.render(),t.redraw()});var{min:a,max:i}=this.getInitialExtremes();t.chart.xAxis[0].userMin=a,t.chart.xAxis[0].userMax=i,t.render(a,i)}getRange(){var{min:t,max:a}=this.navigator.chart.xAxis[0].getExtremes(),{userMin:i,userMax:r,min:e,max:s}=this.navigator.xAxis.getExtremes();return{min:pick(t,e),max:pick(a,s),dataMin:e,dataMax:s,userMin:i,userMax:r}}setRange(t,a,i,r,e){fireEvent(this.navigator,"setRange",{min:t,max:a,redraw:i,animation:r,eventArguments:merge(e,{trigger:"navigator"})})}getInitialExtremes(){var{min:t,max:a}=this.navigator.xAxis.getExtremes();return{min:t,max:a}}}export default StandaloneNavigator;